maintainer="Krassy Boykinov <kboykinov@teamcentrixx.com>"
pkgname=libvpl
pkgver=2.15.0
pkgrel=1
pkgdesc="Intel Video Processing Library (Intel VPL)"
url="https://github.com/intel/libvpl"
arch="x86_64" # only x86_64 supported
license="MIT"
makedepends="cmake samurai"
provides="onevpl=2025.0.0-r0" # backward compatibility
subpackages="$pkgname-doc $pkgname-dev"
source="$pkgname-$pkgver.tar.gz::https://github.com/intel/libvpl/archive/refs/tags/v$pkgver.tar.gz"

build() {
	CXXFLAGS="$CXXFLAGS -flto=auto" \
	cmake -B build -G Ninja \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DVPL_INSTALL_ENVDIR=/usr/share/libvpl/env \
		-DVPL_INSTALL_LICENSEDIR=/usr/share/doc/libvpl \
		-DVPL_INSTALL_MODFILEDIR=/usr/share/libvpl/modulefiles \
		-DBUILD_EXAMPLES=OFF \
		-DINSTALL_EXAMPLES=OFF \
		-DBUILD_TESTS="$(want_check && echo ON || echo OFF)"
	cmake --build build
}

check() {
	ctest --test-dir build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

dev() {
	default_dev

	amove usr/share
}

sha512sums="
daf7c3d5722515ed2346e252b39f117c0c3f24f6c80ab3492bd7107b2207c49c0d2247cc2d043298f43045884247024a109c698751fcbd88eb5ab54a4122c26d  libvpl-2.15.0.tar.gz
"
