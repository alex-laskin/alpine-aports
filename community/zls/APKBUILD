# Maintainer: Rabindra Dhakal <contact@qaidvoid.dev>
pkgname=zls
pkgver=0.15.0
pkgrel=0
_knownfolders=92defaee76b07487769ca352fd0ba95bc8b42a2f
_diffz=a20dd1f11b10819a6f570f98b42e1c91e3704357
_lspkit=576e9405b1ab22c17c0f9318feed3278aa66b0ea
_tracy=0.11.1
pkgdesc="Zig Language Server"
url="https://github.com/zigtools/zls"
arch="aarch64 x86_64" # Limited by zig
license="MIT"
depends="zig"
source="
	https://github.com/zigtools/zls/archive/refs/tags/$pkgver/zls-$pkgver.tar.gz
	https://github.com/ziglibs/known-folders/archive/$_knownfolders/known-folders-$_knownfolders.tar.gz
	https://github.com/ziglibs/diffz/archive/$_diffz/diffz-$_diffz.tar.gz
	https://github.com/zigtools/lsp-kit/archive/$_lspkit/lsp-kit-$_lspkit.tar.gz
	https://github.com/wolfpld/tracy/archive/refs/tags/v$_tracy/tracy-$_tracy.tar.gz
	"

export ZIG_GLOBAL_CACHE_DIR="$srcdir"/cache

prepare() {
	default_prepare

	mkdir -p "$srcdir"/cache/p
	mv "$srcdir"/known-folders-$_knownfolders "$srcdir"/cache/p/known_folders-0.0.0-Fy-PJkfRAAAVdptXWXBspIIC7EkVgLgWozU5zIk5Zgcy
	mv "$srcdir"/diffz-$_diffz "$srcdir"/cache/p/diffz-0.0.1-G2tlIQrOAQCfH15jdyaLyrMgV8eGPouFhkCeYFTmJaLk
	mv "$srcdir"/lsp-kit-$_lspkit "$srcdir"/cache/p/lsp_kit-0.1.0-bi_PL04yCgAxLsF0hH2a5sZKT84MGQaKXouw2jvCE8Nl
	mv "$srcdir"/tracy-$_tracy "$srcdir"/cache/p/N-V-__8AAMeOlQEipHjcyu0TCftdAi9AQe7EXUDJOoVe0k-t
}

build() {
	zig build \
		-Dcpu=baseline \
		-Doptimize=ReleaseSafe \
		-Dversion-string="$pkgver" \
		-Dpie=true
}

check() {
	zig build test \
		-Dcpu=baseline \
		-Dversion-string="$pkgver" \
		-Dpie=true
}

package() {
	install -Dm755 zig-out/bin/zls -t "$pkgdir"/usr/bin/
}

sha512sums="
8c5eb105182b1b915d8f0fa96734b61640fbc00619a1e38cf955c5ac31ab7355fd0fab847d89fffe18798cc084beaaa66e04644d0cd3b523bec01258f961b63c  zls-0.15.0.tar.gz
113ebc487f66d42f5f0ddcb7178a381be5cd41413de119fe4f719434abbb408afcba4eaaf0ed8a37ffc4100a28eeae444780c9e303618280e6335ad6317c7d7e  known-folders-92defaee76b07487769ca352fd0ba95bc8b42a2f.tar.gz
e2f36f395b60d402bdff1cf6e8254157e1e0e6baaca91eca3da81d2f86125643495a8f53610c4cfdead4ef9c7eea1d5ffe036cec12aabac0c333541a555fc475  diffz-a20dd1f11b10819a6f570f98b42e1c91e3704357.tar.gz
163e5474adb4cb9df7467917d0d774df3cae81f638f94357abc39c210311ce3c8cff54b479158a68dd50bbfd2f89b2174267fd3b544c99772ff2027f767e8a8e  lsp-kit-576e9405b1ab22c17c0f9318feed3278aa66b0ea.tar.gz
d3d99284e3c3172236c3f02b3bc52df111ef650fb8609e54fb3302ece28e55a06cd16713ed532f1e1aad66678ff09639dfc7e01a1e96880fb923b267a1b1b79b  tracy-0.11.1.tar.gz
"
