# Contributor: Jesse Young <jlyo@jlyo.org>
# Maintainer: Stuart Cardall <developer@it-offshore.co.uk>
pkgname=ucspi-tcp6
pkgver=1.13.06
pkgrel=0
pkgdesc="IPv6 enabled ucspi-tcp superserver"
url="http://www.fehcom.de/ipnet/ucspi-tcp6.html"
arch="all"
license="Public-Domain"
subpackages="$pkgname-doc"
provides="ucspi-tcp"
makedepends="fehqlibs"
options="!check"
source="https://www.fehcom.de/ipnet/ucspi-tcp6/ucspi-tcp6-$pkgver.tgz"

builddir="$srcdir/net/$pkgname/$pkgname-${pkgver%%[a-zA-Z]}"

build() {
	echo "/usr/lib/qlibs" > conf-qlibs
	echo "/usr" > conf-home
	echo "/usr" > src/home

	export CFLAGS="$CFLAGS -I/usr/lib/qlibs/include"
	export LDFLAGS="$LDFLAGS -L/usr/lib/qlibs"

	make -C src -j1 # makefiles are not threadsafe, use one thread only.
}

package() {
	cat package/commands-base | while IFS= read -r file
	do
		install -Dm0755 "src/$file" "$pkgdir/usr/bin/$file"
	done

	# need to `cd` here to keep code shorter
	(
	cd man
	for file in *.[0-9]; do
		install -Dm0644 -t "$pkgdir/usr/share/man/man${file##*[a-zA-Z.]}" "$file"
	done
	)

	install -Dm0644 doc/LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
}

sha512sums="
6eda0fc4f328824964b2b46a38635d1e86e230bd88c2884cd4d84210957a5501cebec64c88838c576e1dbe640dbf8eff0c74431cea451b3466a7925033c17b71  ucspi-tcp6-1.13.06.tgz
"
