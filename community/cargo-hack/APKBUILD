maintainer="Paolo Barbolini <paolo.barbolini@m4ss.net>"
pkgname=cargo-hack
pkgver=0.6.39
pkgrel=0
pkgdesc="Cargo subcommand to provide various options useful for testing and continuous integration."
url="https://github.com/taiki-e/cargo-hack"
arch="all"
license="MIT OR Apache-2.0"
makedepends="
	cargo
	cargo-auditable
	"
subpackages="$pkgname-doc"
# Cargo.lock extracted from https://static.crates.io/crates/cargo-hack/cargo-hack-$pkgver.crate
source="
	$pkgname-$pkgver.tar.gz::https://github.com/taiki-e/cargo-hack/archive/refs/tags/v$pkgver.tar.gz
	Cargo.lock
"
# net: cargo fetch
# !check: tests expect to be running in a git checkout
options="net !check"

prepare() {
	default_prepare

	cp "$srcdir"/Cargo.lock .
	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --release --frozen
}

package() {
	install -Dm755 target/release/cargo-hack -t "$pkgdir"/usr/bin/

	install -Dm 644 README.md -t "$pkgdir"/usr/share/doc/"$pkgname"/
	install -Dm 644 LICENSE-MIT -t "$pkgdir"/usr/share/licenses/"$pkgname"/
	install -Dm 644 LICENSE-APACHE -t "$pkgdir"/usr/share/licenses/"$pkgname"/
}

sha512sums="
c9f6015bcd68cd057a88f56dc3b61ee39511915efb21bf4914b3a77e6f90f30464d021eb0198755d7f37ad43485f62cb3c1847b794dce53bbaf8d0cec566fc4b  cargo-hack-0.6.39.tar.gz
cff12513b45e4bbc42ce47e7de28238a51a4e21c632512ecaa7902a0d811aa8c2b2c37e769ed09cbd94b80673ce1a7c91dc55e1846990256f876b1d57012ab9a  Cargo.lock
"
