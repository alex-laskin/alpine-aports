maintainer="Achill Gilgenast <achill@achill.org>"
pkgname=cellbroadcastd
pkgver=0.0.3
pkgrel=0
pkgdesc="Manages cell broadcast messages received via ModemManager"
url="https://gitlab.freedesktop.org/devrtz/cellbroadcastd"
arch="all"
license="LGPL-2.1-or-later"
makedepends="
	glib-dev
	gmobile-dev
	gobject-introspection-dev
	meson
	mobile-broadband-provider-info
	modemmanager-dev
	vala
	"
checkdepends="dbus"
subpackages="$pkgname-libs $pkgname-dev"
source="https://sources.phosh.mobi/releases/cellbroadcastd/cellbroadcastd-$pkgver.tar.xz"

build() {
	abuild-meson \
		output .
	meson compile -C output
}

check() {
	meson test --print-errorlogs -C output
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C output

	# We don't ship systemd
	rm -r "$pkgdir"/usr/lib/systemd
}

sha512sums="
52b4199dd4fbd8a1af1ff23f6dda7b2e3220bf8f5fbb2eb32c332d38842c3cea1c13941ade228088d6be474b3f53362aa8127655e2fd3734801049a12b7285a0  cellbroadcastd-0.0.3.tar.xz
"
