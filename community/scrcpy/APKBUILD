# Contributor: prspkt <prspkt@protonmail.com>
# Maintainer: prspkt <prspkt@protonmail.com>
pkgname=scrcpy
pkgver=3.3.3
pkgrel=0
pkgdesc="Display and control your Android device"
url="https://github.com/Genymobile/scrcpy"
arch="all !s390x !ppc64le !loongarch64" # limited by android-tools
license="Apache-2.0"
options="!check" # no test suite
depends="android-tools"
makedepends="ffmpeg-dev mesa-dev meson sdl2-dev libusb-dev"
subpackages="$pkgname-doc
	$pkgname-bash-completion
	$pkgname-zsh-completion"
source="scrcpy-$pkgver.tar.gz::https://github.com/Genymobile/scrcpy/archive/v$pkgver.tar.gz
	https://github.com/Genymobile/scrcpy/releases/download/v$pkgver/scrcpy-server-v$pkgver"

build() {
	abuild-meson \
		-Dcompile_server=false \
		-Dprebuilt_server=/usr/share/scrcpy/scrcpy-server-v$pkgver \
		. output
	meson compile -C output
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C output
	install -Dm644 "$srcdir"/scrcpy-server-v$pkgver \
		"$pkgdir"/usr/share/scrcpy/scrcpy-server
}

sha512sums="
626f9f99f5c032520c8348d44fb19a39f5a56edba17c3f10438d9156b9d35b11c0bae60f5e140e4c30ab6cb9e068f67b4329edcd1bdfa9cba43ecb08616dd33a  scrcpy-3.3.3.tar.gz
73dfa8c983b19970b52ce21dc2605aae8fb6c25135b3e74cf77e55aba6a98aeba7a7cc3bdd5f900feca6ffdb0ad7c66598719f40a73cd9e25a6299ac3606dcad  scrcpy-server-v3.3.3
"
