# Maintainer:
pkgname=uhd
pkgver=4.9.0.0
pkgrel=0
pkgdesc="USRP Hardware Driver"
url="https://github.com/EttusResearch/uhd"
options="!check" # no tests
arch="all"
license="GPL-3.0-or-later"
makedepends="
	boost-dev
	cmake
	libusb-dev
	py3-numpy-dev
	py3-mako
	py3-pybind11-dev
	py3-setuptools
	python3-dev
	samurai
	"
subpackages="$pkgname-dev $pkgname-libs $pkgname-doc"
source="
	$pkgname-$pkgver.tar.gz::https://github.com/EttusResearch/uhd/archive/refs/tags/v$pkgver.tar.gz
	gcc-15.patch
	"

build() {
	case "$CARCH" in
	aarch64)
		local neon=ON
		;;
	*)
		local neon=OFF
		;;
	esac
	cmake -B build-host -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DCMAKE_BUILD_TYPE=MinSizeRel \
		-DNEON_SIMD_ENABLE=$neon \
		-DUHD_VERSION=$pkgver \
		host
	cmake --build build-host
}

package() {
	DESTDIR="$pkgdir" cmake --install build-host
}

sha512sums="
df8dc56035c5fb18b958fdb6ffd28ed1bbf4a4dd051800865fe4e9a2df953e13e1930ed285507dc6d2736443a285283741b1d0dc3dae862b0bb3e477d8532641  uhd-4.9.0.0.tar.gz
612692e0e793e5388702696d365c614cb2c07e4ddce8cb4f54299e66faba0e4924855ccf20738064753d4349c2713f52fe54cec9b8c1611889c3cfcfce232a58  gcc-15.patch
"
