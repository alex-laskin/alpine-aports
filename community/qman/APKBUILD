# Maintainer: Celeste <cielesti@protonmail.com>
maintainer="Celeste <cielesti@protonmail.com>"
pkgname=qman
pkgver=1.5.0
pkgrel=0
pkgdesc="Modern man page viewer for the terminal"
url="https://github.com/plp13/qman"
arch="all"
license="BSD-2-Clause"
depends="
	groff
	man-db
	"
makedepends="
	bzip2-dev
	cogapp
	libbsd-dev
	muon
	ncurses-dev
	xz-dev
	zlib-dev
	"
checkdepends="
	bash
	cunit-dev
	"
subpackages="$pkgname-doc"
source="https://github.com/plp13/qman/archive/refs/tags/v$pkgver/qman-$pkgver.tar.gz"

build() {
	# _GNU_SOURCE: for strcasestr
	CFLAGS="$CFLAGS -D_GNU_SOURCE $(pkgconf --cflags libbsd-overlay)" \
	abuild-muon \
		-Dman-pages=enabled \
		-Dconfig=enabled \
		-Dlibbsd=enabled \
		-Dgzip=enabled \
		-Dbzip2=enabled \
		-Dlzma=enabled \
		-Dtests="$(want_check && echo enabled || echo disabled)" \
		output .
	ninja -C output
}

check() {
	TERM=linux muon -C output test -j "${JOBS:-0}" -R -d dots -vv
}

package() {
	DESTDIR="$pkgdir" muon -C output install
}

sha512sums="
6c54f5366f31ed65d28d803853269c000cd4143586ec6100857ef3c0d6662d2336442eaeeb73bbad4654e24e78ca10930eb543d0d2320ec3ae4b61234f307973  qman-1.5.0.tar.gz
"
