maintainer="Achill Gilgenast <achill@achill.org>"
pkgname=chatterino2
pkgver=2.5.4
_certify_commit=a448a3915ddac716ce76e4b8cbf0e7f4153ed1e2
_crash_handler_commit=c8cf62b64906f794ac84cb0c22ceb401f4ea1e8d
_libcommuni_commit=2979eb96262756047a8dca47f2e509168138c0d0
_lua_commit=1ab3208a1fceb12fca8f24ba57d6e13c5bff15e3
_magicenum_commit=e55b9b54d5cf61f8e117cafb17846d7d742dd3b4
_miniaudio_commit=350784a9467a79d0fa65802132668e5afbcf3777
_sanitizers_cmake_commit=0573e2ea8651b9bb3083f193c41eb086497cc80a
_serialize_commit=17946d65a41a72b447da37df6e314cded9650c32
_settings_commit=9b5c05ee2129e9eaa641d08a49096682105c2588
_signals_commit=d06770649a7e83db780865d09c313a876bf0f4eb
_sol2_commit=2b0d2fe8ba0074e16b499940c4f3126b9c7d3471
_websocketpp_commit=f1736a8e72b910810ff6869fe20f647a62f3bc35
pkgrel=0
pkgdesc="Chat client for twitch.tv"
url="https://chatterino.com/"
arch="all"
license="MIT"
depends="qt6-qtimageformats"
makedepends="
	boost-dev
	cmake
	doxygen
	expected-lite
	libnotify-dev
	openssl-dev
	qt6-qt5compat-dev
	qt6-qtbase-dev
	qt6-qtimageformats-dev
	qt6-qtsvg-dev
	qt6-qttools-dev
	qtkeychain-dev
	rapidjson-dev
	samurai
	"
source="$pkgname-$pkgver.tar.gz::https://github.com/Chatterino/chatterino2/archive/refs/tags/v$pkgver.tar.gz
	$pkgname-certify-$_certify_commit.tar.gz::https://github.com/Chatterino/certify/archive/$_certify_commit.tar.gz
	$pkgname-crash-handler-$_crash_handler_commit.tar.gz::https://github.com/Chatterino/crash-handler/archive/$_crash_handler_commit.tar.gz
	$pkgname-serialize-$_serialize_commit.tar.gz::https://github.com/pajlada/serialize/archive/$_serialize_commit.tar.gz
	$pkgname-settings-$_settings_commit.tar.gz::https://github.com/pajlada/settings/archive/$_settings_commit.tar.gz
	$pkgname-signals-$_signals_commit.tar.gz::https://github.com/pajlada/signals/archive/$_signals_commit.tar.gz
	libcommuni-$_libcommuni_commit.tar.gz::https://github.com/Chatterino/libcommuni/archive/$_libcommuni_commit.tar.gz
	lua-$_lua_commit.tar.gz::https://github.com/lua/lua/archive/$_lua_commit.tar.gz
	magicenum-$_magicenum_commit.tar.gz::https://github.com/Neargye/magic_enum/archive/$_magicenum_commit.tar.gz
	miniaudio-$_miniaudio_commit.tar.gz::https://github.com/mackron/miniaudio/archive/$_miniaudio_commit.tar.gz
	sanitizers-cmake-$_sanitizers_cmake_commit.tar.gz::https://github.com/arsenm/sanitizers-cmake/archive/$_sanitizers_cmake_commit.tar.gz
	sol2-$_sol2_commit.tar.gz::https://github.com/ThePhD/sol2/archive/$_sol2_commit.tar.gz
	websocketpp-$_websocketpp_commit.tar.gz::https://github.com/zaphoyd/websocketpp/archive/$_websocketpp_commit.tar.gz
	32bit.patch
	"
options="!check" # more complex: requires to start 2 servers: https://github.com/Chatterino/chatterino2/tree/master/tests

prepare() {
	default_prepare

	mv "$srcdir"/certify-*/* "$srcdir"/chatterino2-$pkgver/lib/certify/
	mv "$srcdir"/crash-handler-*/* "$srcdir"/chatterino2-$pkgver/tools/crash-handler/
	mv "$srcdir"/libcommuni-*/* "$srcdir"/chatterino2-$pkgver/lib/libcommuni/
	mv "$srcdir"/lua-*/* "$srcdir"/chatterino2-$pkgver/lib/lua/src/
	mv "$srcdir"/magic_enum-*/* "$srcdir"/chatterino2-$pkgver/lib/magic_enum/
	mv "$srcdir"/miniaudio-*/* "$srcdir"/chatterino2-$pkgver/lib/miniaudio/
	mv "$srcdir"/sanitizers-cmake-*/* "$srcdir"/chatterino2-$pkgver/cmake/sanitizers-cmake/
	mv "$srcdir"/serialize-*/* "$srcdir"/chatterino2-$pkgver/lib/serialize/
	mv "$srcdir"/settings-*/* "$srcdir"/chatterino2-$pkgver/lib/settings/
	mv "$srcdir"/signals-*/* "$srcdir"/chatterino2-$pkgver/lib/signals/
	mv "$srcdir"/sol2-*/* "$srcdir"/chatterino2-$pkgver/lib/sol2/
	mv "$srcdir"/websocketpp-*/* "$srcdir"/chatterino2-$pkgver/lib/websocketpp/
}

build() {
	if [ "$CBUILD" != "$CHOST" ]; then
		local crossopts="-DCMAKE_SYSTEM_NAME=Linux -DCMAKE_HOST_SYSTEM_NAME=Linux"
	fi
	cmake -B build -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DBUILD_SHARED_LIBS=ON \
		-DCMAKE_BUILD_TYPE=None \
		-DUSE_SYSTEM_QTKEYCHAIN=ON \
		-DUSE_PRECOMPILED_HEADERS=OFF \
		-DBUILD_WITH_QT6=ON \
		-DCHATTERINO_UPDATER=OFF \
		$crossopts
	cmake --build build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
daf1ff5186f64baa51099231af0f3469a30792acbfb407d11a06daa87069a62d19fdda69f7642acbe7858cd4d0355037b2577d24c9e38a5e33592160291c5d4e  chatterino2-2.5.4.tar.gz
557e55fe24f04b688f02e6f4dd99f4e61e5d2361c107e266ff729786e36fb8c2f43fb4c4fc8fe51578656c66b866073cf529ef3347d4226ae34ba29c1e4e320e  chatterino2-certify-a448a3915ddac716ce76e4b8cbf0e7f4153ed1e2.tar.gz
a7658d1b7e29da5647e60435a6daf55763dccaf1b14d7c5bd15491e449b2c9325b7f1796ced8802523d95888a683e4b68aab13195ba968d110979dec32d34721  chatterino2-crash-handler-c8cf62b64906f794ac84cb0c22ceb401f4ea1e8d.tar.gz
2ea660b6f164b8ba5b419e8381272dca507fcab09434421915a9b4be5e95cba08e72e708f16b3b22f5e0cae6dab2ef332d0a7976c287f048710e328d9a8913be  chatterino2-serialize-17946d65a41a72b447da37df6e314cded9650c32.tar.gz
d2cd762f002b253e646cbf6aca47c00ae99b578521370ad13b477e4b344af23b16409497c7e05a12b8a0e45a9908066e3b1248f4a8bd455519ff98a4f8ace0d9  chatterino2-settings-9b5c05ee2129e9eaa641d08a49096682105c2588.tar.gz
5489151f2d036dc8834346f902cf740e1b1b6823d385d2bc7c5d715af6911ade9ee383c591c48bdb8bdfca70890f48e8333ee39c6319d3871239f99d34a51cc9  chatterino2-signals-d06770649a7e83db780865d09c313a876bf0f4eb.tar.gz
6718a7fda15bf8cb644a0f64c70cc06441c53c36b63f4763a7b6312ddde41e1bb8aad576a194ab732c66c0bed4efbb03321d6ecd3656ff943efa1c23df81e5f9  libcommuni-2979eb96262756047a8dca47f2e509168138c0d0.tar.gz
45c65cd8c579412d2d89c3899c5a98157c66306423ecaafa31b3c386f62ef900f7832de45b8c6a2804001f7676afda1ce8785b3933830dd21515a2c49b0a1fe7  lua-1ab3208a1fceb12fca8f24ba57d6e13c5bff15e3.tar.gz
466ba8e6e9122e55fb49b1a842b3f88ddc5faa5ea096df445dec1feba0c9db09748e735874b7839bf5f822f39480fa556a6bfaac0855c065df23b00ce45c5b3d  magicenum-e55b9b54d5cf61f8e117cafb17846d7d742dd3b4.tar.gz
a3030d58277fec9b9c3bd93fe32a80caf62e96d1fedec6a4b645a8ba4c6db8c8911a68e9b855ac543713afb0ccd70cfc52177dbf1e2ffaf5fabf19439b1c9fc4  miniaudio-350784a9467a79d0fa65802132668e5afbcf3777.tar.gz
80d1c471492a771b12291e36cc7523e65c8f9add5b14643c9554156bbcc3e1753772054998306c3f89d33b7f5c9969e89670e16428a72040033b41329c9cb71b  sanitizers-cmake-0573e2ea8651b9bb3083f193c41eb086497cc80a.tar.gz
912a887376b79edfa1a021e88a0552db43d6b42c6c65cca43ea3bcc6f791cfeabc4b1abdfbf55a2878881bdbec4eb9dfec4498fcf33c84e70394a49dfdc21f5c  sol2-2b0d2fe8ba0074e16b499940c4f3126b9c7d3471.tar.gz
a340ee4f9e40adcdb02e784157b05c881240d4c5a3eb458761b56af4a3eebf410ae3530e3dc6fd57ce7f06174eabe3c07d30f8e2c615d7468fe3dec5cb0b113c  websocketpp-f1736a8e72b910810ff6869fe20f647a62f3bc35.tar.gz
3aa50540d2947b57bfcea07d6023712983e9a2c5b8f708a4c9562c6884adf5eee5b1e0a8add783dc2b5148ceece16445414d525dd0cc677a9bd471ad900f186e  32bit.patch
"
