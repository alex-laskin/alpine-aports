# Contributor: qaqland <qaq@qaq.land>
# Maintainer: qaqland <qaq@qaq.land>
pkgname=libtbox
pkgver=1.7.8
pkgrel=0
pkgdesc="A glib-like multi-platform c library"
url="https://github.com/tboox/tbox"
arch="all"
license="Apache-2.0"
subpackages="$pkgname-dev"
makedepends="linux-headers"
source="$pkgname-$pkgver.tar.gz::https://github.com/tboox/tbox/archive/refs/tags/v$pkgver.tar.gz
	$pkgname.pc
	"
builddir="$srcdir/tbox-$pkgver"

prepare() {
	default_prepare
	chmod -x ./*.md
}

build() {
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--kind=shared \
		--force_utf8=yes \
		--charset=yes \
		--float=yes \
		--hash=yes
	make
}

check() {
	make run
}

package() {
	make DESTDIR="$pkgdir" install
	rm "$pkgdir/usr/bin/demo"

	mkdir -p "$pkgdir/usr/lib/pkgconfig/"
	sed "s/@VERSION@/$pkgver/" "$srcdir/$pkgname.pc" > "$pkgdir/usr/lib/pkgconfig/$pkgname.pc"
}

sha512sums="
fa2c43c58a21ae9ef39bf28bc00006b94f4c31460fd69ccfc4208f470656901656c0b2c294f44e38fdab39b84227cb553663af0c9b78d3400584fe4976caee15  libtbox-1.7.8.tar.gz
9b9e41014af55df80419fde320784e396a6a54005cf09393567f43ce146b94494090927fdfa2685edf3b72bc5ff4d155c99a037d4ea8c9a3cb649187ac4c9a32  libtbox.pc
"
