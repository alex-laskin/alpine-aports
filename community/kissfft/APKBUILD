maintainer="Sodface <sod@sodface.com>"
pkgname=kissfft
pkgver=131.2.0
pkgrel=0
pkgdesc="Fast Fourier Transform (FFT) library that tries to Keep it Simple, Stupid"
url="https://github.com/mborgerding/kissfft"
arch="all"
license="BSD-3-Clause"
depends_dev="$pkgname=$pkgver-r$pkgrel"
makedepends="
	cmake
	fftw-dev
	libpng-dev
	samurai
	"
checkdepends="
	py3-numpy
	python3
	"
subpackages="
	$pkgname-dev
	$pkgname-libs
	"
source="$pkgname-$pkgver.tar.gz::https://github.com/mborgerding/kissfft/archive/refs/tags/$pkgver.tar.gz
	fix-python-detection.patch
	mpil.patch
	"

build() {
	CFLAGS="$CFLAGS -O2 -flto=auto" \
	CXXFLAGS="$CXXFLAGS -O2 -flto=auto" \
	cmake -B build -G Ninja \
		-DCMAKE_BUILD_TYPE=None \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DKISSFFT_TEST="$(want_check && echo ON || echo OFF)"
	cmake --build build
}

check() {
	ctest --test-dir build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
5d02802a9e191e7cb77c26e9a34659a5d47c4e85bcfdf86a7cffdda66d8b79261f7fe5795ffabd78644b6094c01b32a84841669fbc0009ac9268ae1ba521af9e  kissfft-131.2.0.tar.gz
fe5568fe3f6adf1e16c3ad8c9df24e8cc4d489f0b9c1a1e96dfcf47e992319fdb4086fd493290fd4fde69d0c9b70a561c1d797cf880688d8ad208d4ff9195b20  fix-python-detection.patch
fa1311363ba71bf3d091836d64fffd556e3221c2c7131de8fb640cfd86607e35db88c9b93b9f7c175344ab6c3629e1b571936dd986750199c27ba229d43032b0  mpil.patch
"
