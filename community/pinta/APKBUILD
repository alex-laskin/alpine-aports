# Contributor: knuxify <knuxify@gmail.com>
# Maintainer:
pkgname=pinta
pkgver=3.0.4
pkgrel=0
# Use corresponding gitrev hash to get missing Pinta.AddinUtils files
_gitrev="ac739822816b7d1925074adc9c29d5cf37b664b5"
pkgdesc="Simple GTK# paint program"
url="https://www.pinta-project.com/"
arch="x86_64 aarch64 armv7"
license="MIT"
depends="dotnet9-runtime webp-pixbuf-loader"
makedepends="autoconf-archive dotnet9-sdk gettext-dev gtk4.0-dev intltool libadwaita-dev"
subpackages="$pkgname-dev $pkgname-doc $pkgname-lang"
source="https://github.com/PintaProject/Pinta/releases/download/$pkgver/pinta-$pkgver.tar.gz
	https://github.com/PintaProject/Pinta/raw/$_gitrev/installer/addins/Pinta.AddinUtils.csproj
	https://github.com/PintaProject/Pinta/raw/$_gitrev/installer/addins/Program.cs
	"

prepare() {
	default_prepare
	# Modify buildprops for .Net 9.x
	sed -i 's/net8.0/net9.0/g' Directory.Build.props
	sed -i 's/StartupWMClass=Pinta/StartupWMClass=com.github.PintaProject.Pinta/g' \
		xdg/pinta.desktop.in

	# Temporarily move files until they are included in the tarball
	mkdir installer/addins
	mv "$srcdir"/Pinta.AddinUtils.csproj installer/addins/
	mv "$srcdir"/Program.cs installer/addins/
}

build() {
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--localstatedir=/var
	make
}

check() {
	make test
}

package() {
	make DESTDIR="$pkgdir" install
}

sha512sums="
f36fb33cd791480f072cc48fba9e01bbc1f1c2ac25d4ed1bfc36995951cd46850f4a9203cd5ec7cc3adb2f31ff7e5eb4eea8dd0d7d08f50848d9262130bc3795  pinta-3.0.4.tar.gz
46f3a1643d3d522f4c678408ae8e36c24b72df12c0cd8fa5fdd6ebf062394d110fd9fcf1411048e9076d231d9413a5f95d9aa9c43e13bc9b6fdc18b2dbabaee4  Pinta.AddinUtils.csproj
11b7d5184effae26a6a1dbe63521897f7fa03d0849be40d523029e393883f9da3394b6ee3579e7a6dba933daacfa303fd379ed09edb3c5ba2b86929950170daf  Program.cs
"
