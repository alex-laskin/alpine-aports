# Maintainer: Celeste <cielesti@protonmail.com>
maintainer="Celeste <cielesti@protonmail.com>"
pkgname=gitu
pkgver=0.38.0
pkgrel=0
pkgdesc="TUI Git client inspired by Magit"
url="https://github.com/altsem/gitu"
# s390x: nix crate, 32-bit: tests fail
arch="all !s390x !armhf !armv7 !x86"
license="MIT"
depends="git"
makedepends_build="cargo cargo-auditable"
makedepends_host="libgit2-dev"
subpackages="$pkgname-doc"
source="https://github.com/altsem/gitu/archive/refs/tags/v$pkgver/gitu-$pkgver.tar.gz"

prepare() {
	default_prepare

	cargo fetch --target="$CHOST" --locked
}

build() {
	cargo auditable build --frozen --release
}

check() {
	cargo test --frozen
}

package() {
	local targetdir="target/${CARGO_BUILD_TARGET:+$CARGO_BUILD_TARGET/}"

	install -Dvm755 $targetdir/release/gitu -t "$pkgdir"/usr/bin/

	install -Dvm644 README.md -t "$pkgdir"/usr/share/doc/$pkgname/
	install -Dvm644 LICENSE -t "$pkgdir"/usr/share/licenses/$pkgname/
}

sha512sums="
9d58ce63a317c128f51f5031f5a1e233d4b9f48916097ec67139ba137029b3ccfad2d09f2c3939627e20d2a8bdde4acdb2c7ef59d513fe9ceb656ad48b3dde30  gitu-0.38.0.tar.gz
"
