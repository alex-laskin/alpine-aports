# Contributor: Micheal Smith <xulfer@cheapbsd.net>
# Maintainer: Micheal Smith <xulfer@cheapbsd.net>
pkgname=chiaki
pkgver=2.2.0
pkgrel=2
pkgdesc="Open Source PS4 and PS5 remote play client"
url="https://git.sr.ht/~thestr4ng3r/chiaki"
arch="all !s390x"
license="GPL-3.0-or-later"
makedepends="
	cmake
	ffmpeg7-dev
	openssl-dev
	opus-dev
	protobuf
	protoc
	py3-protobuf
	py3-setuptools
	python3
	qt5-qtmultimedia-dev
	qt5-qtsvg-dev
	samurai
	sdl2-dev
	"
source="$pkgname-$pkgver-src.tar.gz::https://git.sr.ht/~thestr4ng3r/chiaki/refs/download/v$pkgver/chiaki-v$pkgver-src.tar.gz
	c23.patch
	nanopb-protobuf.patch
	"
builddir="$srcdir/$pkgname"

build() {
	cmake3.5 -B build -G Ninja \
		-DCMAKE_BUILD_TYPE=None \
		-DCMAKE_INSTALL_PREFIX=/usr
	cmake --build build
}

check() {
	ctest --test-dir build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
1d9c02911073776047c472043526f27ab53d5a517e4646b8d2c910401dffd20a5aaebe5737c9cb399665e2334e1a75b2528c3d03a200dc88423141f96127897e  chiaki-2.2.0-src.tar.gz
c7816316fbfa22320ed997da5d0e1a2cbd70f0e0e3b2b08444da252aebe9667b03b63cbc81a50cb128a2f37f538a86bc1d2590b9108e43746393a6e10928deb4  c23.patch
dd10a30b51bf60605eefeeb1fd6881316014f50698ab06dd27e337a5999c69de7b64812b6b1d3e1855f5d1c3e0b7ca07b5817a3461d6a40723e969fba881eb5a  nanopb-protobuf.patch
"
