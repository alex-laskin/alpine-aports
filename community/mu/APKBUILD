# Contributor: SÃ¶ren Tempel <soeren+alpine@soeren-tempel.net>
# Contributor: stef <l0ls0fo2i@ctrlc.hu>
# Contributor: Eivind Uggedal <eu@eju.no>
# Contributor: Nico Schottelius <nico.schottelius@ungleich.ch>
# Contributor: Justin Berthault <justin.berthault@zaclys.net>
# Maintainer: Celeste <cielesti@protonmail.com>
maintainer="Celeste <cielesti@protonmail.com>"
pkgname=mu
pkgver=1.12.13
pkgrel=0
pkgdesc="Utilities for indexing and searching Maildirs"
url="https://www.djcbsoftware.nl/code/mu/"
arch="all"
license="GPL-3.0-or-later"
makedepends="
	emacs-nox
	glib-dev
	gmime-dev
	muon
	readline-dev
	texinfo
	xapian-core-dev
	"
subpackages="$pkgname-doc mu4e::noarch"
source="$pkgname-$pkgver.tar.gz::https://github.com/djcb/mu/archive/v$pkgver.tar.gz
	fix-tests.patch
	"

build() {
	abuild-muon \
		-Dguile=disabled \
		-Dreadline=enabled \
		-Dtests="$(want_check && echo enabled || echo disabled)" \
		build

	ninja -C build
}

check() {
	muon -C build test -j "${JOBS:-0}" -R -d dots
}

package() {
	DESTDIR="$pkgdir" muon -C build install
}

mu4e() {
	pkgdesc="Emacs-based e-mail client which uses mu as its back-end"
	depends="$pkgname=$pkgver-r$pkgrel cmd:emacs"

	amove usr/share/emacs
}

sha512sums="
6df20707bf8290d2376403a7f6d00bfadff5026aaee5e9080841eacd1f23301874ccd45aacb424933d9240ac2c54c63b8006519592ec47588a5d3c8e21b02ad2  mu-1.12.13.tar.gz
79274299d93768875a851029c8c2d7d2ae48dbfe59bb2b7e1f005ee5d88f93e1cfb3939fbaa443a3e9d9256e4806c5c5f2b6895cb5d50204f1b615124fbf5277  fix-tests.patch
"
