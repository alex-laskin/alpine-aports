Patch-Source: https://fossil-scm.org/home/vpatch?from=merge-in:17c01c549e73c6b8&to=17c01c549e73c6b8
--
Index: test/amend.test
==================================================================
--- test/amend.test
+++ test/amend.test
@@ -312,10 +312,11 @@
   }
   foreach res [lsort -nocase $result] {
     append t2exp "sym-$res*"
   }
   eval fossil amend $HASH $tags
+  set t1exp [string trimleft $t1exp ,]
   test amend-tag-$tc.1 {[string match "*hash:*$HASH*tags:*$t1exp*" $RESULT]}
   fossil tag ls --raw $HASH
   test amend-tag-$tc.2 {[string match $t2exp $RESULT]}
   fossil timeline -n 1
   test amend-tag-$tc.3 {[string match $t3exp $RESULT]}

Index: test/json.test
==================================================================
--- test/json.test
+++ test/json.test
@@ -107,11 +107,11 @@
     set request [subst {POST $url HTTP/1.0\r
 Host: localhost\r
 User-Agent: Fossil-Test\r
 Cookie: $cookie\r
 Content-Type: application/json
-Content-Length $len
+Content-Length: $len
 \r
 $data}]
   } else {
     set request [subst {GET $url HTTP/1.0\r
 Host: localhost\r
@@ -327,11 +327,11 @@
 set anon2 [read_file anon-2]
 fossil_post_json "/json/cap" $anon2
 test json-cap-POSTenv-env-0 {[string length $JR] > 0}
 test_json_envelope_ok json-cap-POSTenv-env
 if {[catch {test json-cap-POSTenv-name \
-    {[dict get $JR payload name] eq "anonymous"} knownBug} jerr]} then {
+    {[dict get $JR payload name] eq "nobody"} knownBug} jerr]} then {
   test json-cap-POSTenv-name-threw 0
   protOut "CAUGHT: $jerr"
 }
 test json-cap-POSTenv-notsetup {![dict get $JR payload permissionFlags setup]}
 
@@ -339,11 +339,11 @@
 # json cap via GET with authToken in Cookie header
 fossil_post_json "/json/cap" {} $AnonCookie
 test json-cap-GETcookie-env-0 {[string length $JR] > 0}
 test_json_envelope_ok json-cap-GETcookie-env-0
 if {[catch {test json-cap-GETcookie-name-0 \
-    {[dict get $JR payload name] eq "anonymous"}} jerr]} then {
+    {[dict get $JR payload name] eq "nobody"}} jerr]} then {
   test json-cap-GETcookie-name-0-threw 0
   protOut "CAUGHT: $jerr"
 }
 test json-cap-GETcookie-notsetup-0 {![dict get $JR payload permissionFlags setup]}
 
@@ -351,11 +351,11 @@
 # json cap via GET with authToken in a parameter
 fossil_post_json "/json/cap?authToken=[dict get $AuthAnon authToken]" {}
 test json-cap-GETcookie-env-1 {[string length $JR] > 0}
 test_json_envelope_ok json-cap-GETcookie-env-1
 if {[catch {test json-cap-GETcookie-name-1 \
-    {[dict get $JR payload name] eq "anonymous"}} jerr]} then {
+    {[dict get $JR payload name] eq "nobody"}} jerr]} then {
   test json-cap-GETcookie-name-1-threw 0
   protOut "CAUGHT: $jerr"
 }
 test json-cap-GETcookie-notsetup-1 {![dict get $JR payload permissionFlags setup]}
 

Index: test/unversioned.test
==================================================================
--- test/unversioned.test
+++ test/unversioned.test
@@ -353,14 +353,11 @@
 
 ###############################################################################
 
 fossil_maybe_answer y unversioned sync $remote
 test unversioned-46 {[regexp \
-{Round-trips: 1   Artifacts sent: 0  received: 0
-Round-trips: 1   Artifacts sent: 0  received: 0
-Round-trips: 2   Artifacts sent: 0  received: 0
-Round-trips: 2   Artifacts sent: 0  received: 2
+{Round-trips: 2   Artifacts sent: 0  received: 2
 \n? done, wire bytes sent: \d+  received: \d+  remote: (?:127\.0\.0\.1|::1)} \
 [normalize_result]]}
 
 ###############################################################################
 
@@ -399,14 +396,11 @@
 
 ###############################################################################
 
 fossil_maybe_answer y unversioned revert $remote
 test unversioned-52 {[regexp \
-{Round-trips: 1   Artifacts sent: 0  received: 0
-Round-trips: 1   Artifacts sent: 0  received: 0
-Round-trips: 2   Artifacts sent: 0  received: 0
-Round-trips: 2   Artifacts sent: 0  received: 2
+{Round-trips: 2   Artifacts sent: 0  received: 2
 \n? done, wire bytes sent: \d+  received: \d+  remote: (?:127\.0\.0\.1|::1)} \
 [normalize_result]]}
 
 ###############################################################################
 
@@ -424,14 +418,11 @@
 
 ###############################################################################
 
 fossil_maybe_answer y unversioned sync $remote
 test unversioned-55 {[regexp \
-{Round-trips: 1   Artifacts sent: 0  received: 0
-Round-trips: 1   Artifacts sent: 0  received: 0
-Round-trips: 2   Artifacts sent: 1  received: 0
-Round-trips: 2   Artifacts sent: 1  received: 0
+{Round-trips: 2   Artifacts sent: 1  received: 0
 \n? done, wire bytes sent: \d+  received: \d+  remote: (?:127\.0\.0\.1|::1)} \
 [normalize_result]]}
 
 ###############################################################################
 
