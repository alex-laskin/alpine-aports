# Contributor: Clayton Craft <clayton@craftyguy.net>
# Maintainer: Clayton Craft <clayton@craftyguy.net>
pkgname=mygui
pkgver=3.4.3
pkgrel=0
pkgdesc="A multilayer and overlappable GUI System"
# Note: only tested on the following archs, may work on others too but not
# adding them until this has been confirmed
arch="x86_64 aarch64"
url="http://mygui.info/"
license="MIT"
makedepends="boost-dev glew-dev cmake oxygen graphviz font-dejavu doxygen freetype-dev ois-dev glu-dev samurai"
subpackages="$pkgname-dev"
source="
	https://github.com/MyGUI/mygui/archive/MyGUI$pkgver.tar.gz
	disable-glvnd-detection.patch
	"
# Package includes unit tests but they require glx/acceleration
options="!check"
builddir="$srcdir/mygui-MyGUI$pkgver"

build() {
	sed -i "71 i set(MYGUI_GCC_VISIBILITY_FLAGS "")" CMakeLists.txt
	sed -i "s/\$OIS_LIBRARIES/$OIS_LIBRARIES boost_system/g" Common/CMakeLists.txt

	cmake -B build -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_BUILD_TYPE=None \
		-DBUILD_SHARED_LIBS=TRUE \
		-DMYGUI_BUILD_DEMOS=FALSE \
		-DMYGUI_BUILD_TOOLS=FALSE \
		-DMYGUI_DONT_USE_OBSOLETE=ON \
		-DMYGUI_INSTALL_DOCS=TRUE \
		-DMYGUI_INSTALL_TOOLS=TRUE \
		-DMYGUI_RENDERSYSTEM=7 \
		-DMYGUI_USE_SYSTEM_GLEW=TRUE

	cmake --build build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
88c69ca2e706af364b72d425f95013eb285501881d8094f8d67e31a54c45ca11b0eb5b62c382af0d4c43f69aa8197648259ac306b72efa7ef3e25eecb9b039cb  MyGUI3.4.3.tar.gz
367eb801c023e8ee55580b31de5f2f89248aa673b16dc09bd65f06afb9c4e2c3f0afb0f976751837e9a3119a80927cd8414511f1b2dd82d1829f18cdae975751  disable-glvnd-detection.patch
"
