Patch-Source: https://github.com/matrix-nio/matrix-nio/pull/550
--
From cb50e35901a18e3cd64776f052e6e7e923eef021 Mon Sep 17 00:00:00 2001
From: Jochen Sprickerhof <jspricke@debian.org>
Date: Sun, 21 Sep 2025 14:12:33 +0200
Subject: [PATCH] Port to new pytest-asyncio

---
 tests/async_client_test.py | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/tests/async_client_test.py b/tests/async_client_test.py
index 0933f8b3..5af30b45 100644
--- a/tests/async_client_test.py
+++ b/tests/async_client_test.py
@@ -2801,7 +2801,7 @@ async def test_exponential_backoff(self, async_client):
 
         assert await get_time(999_999_999) == 30
 
-    async def test_sync_forever(self, async_client, aioresponse, event_loop):
+    async def test_sync_forever(self, async_client, aioresponse):
         sync_url = re.compile(
             rf"^https://example\.org{MATRIX_API_PATH_V3}/sync",
         )
@@ -2833,7 +2833,7 @@ async def test_sync_forever(self, async_client, aioresponse, event_loop):
 
         assert async_client.should_upload_keys
 
-        task: asyncio.Task = event_loop.create_task(
+        task: asyncio.Task = asyncio.get_running_loop().create_task(
             async_client.sync_forever(loop_sleep_time=100)
         )
         await async_client.synced.wait()
@@ -2844,7 +2844,7 @@ async def test_sync_forever(self, async_client, aioresponse, event_loop):
         with pytest.raises(asyncio.CancelledError):
             await task
 
-    async def test_stop_sync_forever(self, async_client, aioresponse, event_loop):
+    async def test_stop_sync_forever(self, async_client, aioresponse):
         sync_url = re.compile(rf"^https://example\.org{MATRIX_API_PATH_V3}/sync")
 
         aioresponse.get(
@@ -2880,7 +2880,7 @@ async def event_callback(event: PresenceEvent):
 
         async_client.add_presence_callback(event_callback, PresenceEvent)
 
-        task: asyncio.Task = event_loop.create_task(
+        task: asyncio.Task = asyncio.get_running_loop().create_task(
             async_client.sync_forever(loop_sleep_time=100)
         )
 
