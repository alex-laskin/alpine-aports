# Contributor: Duncan Bellamy <dunk@denkimushi.com>
# Maintainer: Duncan Bellamy <dunk@denkimushi.com>
pkgname=isa-l_crypto
pkgver=2.25.0
pkgrel=0
pkgdesc="Intelligent Storage Acceleration Library with crypto"
url="https://github.com/intel/isa-l_crypto"
arch="all"
license="BSD-3-Clause"
source="$pkgname-$pkgver.tar.gz::https://github.com/intel/isa-l_crypto/archive/refs/tags/v$pkgver.tar.gz
	missing-prefix.patch
	all-arch.patch
	"
subpackages="$pkgname-dev"
makedepends="autoconf automake libtool openssl-dev linux-headers nasm"

case "$CARCH" in
	# FIXME tests fail on CI
	arm*) options="!check" ;;
esac

prepare() {
	default_prepare
	autoreconf -vif
}

build() {
	./configure --build=$CBUILD --host=$CHOST --disable-static
	make
}

check() {
	make -j1 test
}

package() {
	make DESTDIR="$pkgdir" install
}

sha512sums="
d63f14468258b977cf85bcb2cb5a6de1a678d51631cdbb361aed0f45a5c0ae3770bb40721b6da1cfe889cb88c2c5620a12adf2a8b0c90031f1bfe1b276641f38  isa-l_crypto-2.25.0.tar.gz
652cc89ae6cbe2c366e21f23752067ddea781d47228c332f9ba7d302e22058b045bca3f200f6a365f29a81c7cb7ace955bccdcbe5db8ca3123ace8aeaf5061f0  missing-prefix.patch
dcfe81360e12f487bdbbab16e07fa644e02b8aa1443a1e6a32ef7b545df58c8777e0f45fabed1a6f42a7a28a069774bc61369276ccde184d7586ad2ed3694cf2  all-arch.patch
"
