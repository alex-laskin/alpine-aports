# Contributor: Galen Abell <galen@galenabell.com>
# Maintainer: Galen Abell <galen@galenabell.com>
pkgname=dino
pkgver=0.5.0
pkgrel=2
pkgdesc="Modern Jabber/XMPP client"
url="https://dino.im"
arch="all"
license="GPL-3.0-only"
depends="gst-plugins-good gst-plugins-good-gtk icu-data-full"
makedepends="
	meson
	glib-dev
	glib-networking
	gpgme-dev
	gspell-dev
	gst-libav
	gst-plugins-base-dev
	gtk4.0-dev
	libadwaita-dev
	libcanberra-dev
	libgcrypt-dev
	libgee-dev
	libnice-dev
	libomemo-c-dev
	libqrencode-dev
	libsoup3-dev
	libsrtp-dev
	ninja
	sqlite-dev
	vala
	webrtc-audio-processing-2-dev
	"
subpackages="$pkgname-lang $pkgname-notificationsound"
source="https://github.com/dino/dino/releases/download/v$pkgver/dino-$pkgver.tar.gz
	0001-device-Target-resolution-of-720p-on-libcamera-device.patch
	0002-device-Request-30-fps-in-absence-of-framerate-negoti.patch
	0003-Only-support-SystemMemory-caps-for-video.patch
	"

# secfixes:
#   0.4.2-r0:
#     - CVE-2023-28686
#   0.2.1-r0:
#     - CVE-2021-33896

build() {
	abuild-meson \
		-Dplugin-notification-sound=enabled \
		. output
	meson compile -C output
}

check() {
	meson test --print-errorlogs -C output
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C output
}

notificationsound() {
	amove usr/lib/dino/plugins/notification-sound.so
}

sha512sums="
9cb6db27e6afd42204990c836019bc84a2a61af839d59cf8378520308d3016e6ac674ea4abd3044dfdf18e21e8431ef3cc85ad70d02c89d95c4dc702b32e05d2  dino-0.5.0.tar.gz
18c007edec77363e1770e9e574ef4306b555d764d10aafaa350ae723b15778819e80e4eab5322156019a11c15c16be1cc4a9105fed9245597231cb2e41c0ec05  0001-device-Target-resolution-of-720p-on-libcamera-device.patch
b8d86407b946edb64824f3970170fde38b71a871605946149d6b29152a7a13fc5e292a3d389beb10f4e5c98f1a38bad51bfa4a6664aae95520fa1ab7e19372d0  0002-device-Request-30-fps-in-absence-of-framerate-negoti.patch
408d56e4bf2f9b52162f447f1a58baf8e0bdbbdbb8c27c6c0adc6140d21816436bb88c3b1313fbb77993b68f9444b33423c784677bd13b0a6091f47139ca531b  0003-Only-support-SystemMemory-caps-for-video.patch
"
