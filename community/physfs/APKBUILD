# Contributor: Mikhail Ivko <ivko.mv@gmail.com>
# Maintainer: Simon Zeni <simon@bl4ckb0ne.ca>
pkgname=physfs
pkgver=3.2.0
pkgrel=2
pkgdesc="Library providing access to various archives, for use in video games"
url="https://icculus.org/physfs/"
arch="all"
license="Zlib"
makedepends="cmake samurai"
subpackages="$pkgname-static $pkgname-dev"
source="https://github.com/icculus/physfs/archive/refs/tags/release-$pkgver/physfs-$pkgver.tar.gz
	cmake4.patch"
options="!check" # no tests
builddir="$srcdir/physfs-release-$pkgver"

build() {
	if [ "$CBUILD" != "$CHOST" ]; then
		CMAKE_CROSSOPTS="-DCMAKE_SYSTEM_NAME=Linux -DCMAKE_HOST_SYSTEM_NAME=Linux"
	fi
	cmake -B build \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DBUILD_SHARED_LIBS=True \
		-DCMAKE_BUILD_TYPE=None \
		-DPHYSFS_BUILD_TEST=OFF \
		$CMAKE_CROSSOPTS
	cmake --build build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
e0d84d6ac6bd8f0973149a5add54ed5ed890b5fabb4592ba61b59a3b3e01c05e05f1754f18d7a1c8d72e68777a23cda0c50dc0512cf57a8310a950bf908f54b1  physfs-3.2.0.tar.gz
7ed015e93f6cd1283392d40ee3d9b1c219fe4af3a06024bed99015b40a3abdfc2e369c3cbe86f7f99ebe5146802465db8e3b0ebb07a5f0c8b698be92a649ae2c  cmake4.patch
"
