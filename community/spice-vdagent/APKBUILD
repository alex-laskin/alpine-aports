# Maintainer: Kevin Daudt <kdaudt@alpinelinux.org>
pkgname=spice-vdagent
pkgver=0.23.0
pkgrel=1
pkgdesc="Spice guest agent for Linux"
url="https://spice-space.org/"
arch="all"
license="GPL-3.0-or-later"
makedepends="
	spice-protocol
	alsa-lib-dev
	dbus-dev
	glib-dev
	libdrm-dev
	libpciaccess-dev
	libxfixes-dev
	libxinerama-dev
	libxrandr-dev
	"
checkdepends="procps"
subpackages="$pkgname-doc $pkgname-openrc"
source="https://spice-space.org/download/releases/spice-vdagent-$pkgver.tar.bz2
	spice-vdagentd.initd
	"

build() {
	./configure \
		--prefix=/usr \
		--localstatedir=/var \
		--sysconfdir=/etc \
		--with-session-info=none
	make
}

check() {
	make check
}

package() {
	make install DESTDIR="$pkgdir"
	install -Dm0755 "$srcdir"/spice-vdagentd.initd "$pkgdir"/etc/init.d/spice-vdagentd
	install -dm 0755 "$pkgdir"/usr/lib/modules-load.d/
	printf 'uinput\n' >"$pkgdir"/usr/lib/modules-load.d/spice-vdagent.conf
}

sha512sums="
ab7e6ad34d5fa8ff7aa56f26307bf20f08a3b265713a37a08588d59f224e521f602a4f43084a95f7fa32a6aa67d09f5126a6c5a01412346b8044fea6d91dad30  spice-vdagent-0.23.0.tar.bz2
ba5cf75d2599488dc6f36deac1931b576d5e1a2021ce79df79917c6641b13a93000d9bee62550ecd87ecac30fdc87b044c21b27acecc195ab6bf90485933d350  spice-vdagentd.initd
"
