# Contributor: Martijn Braam <martijn@brixit.nl>
# Maintainer: Martijn Braam <martijn@brixit.nl>
pkgname=logbookd
pkgver=0.2.4
pkgrel=2
pkgdesc="sqlite backed syslogd implementation"
url="https://git.sr.ht/~martijnbraam/logbookd"
arch="all"
license="MIT"
subpackages="$pkgname-doc $pkgname-openrc"
source="
	$pkgname-$pkgver.tar.gz::https://git.sr.ht/~martijnbraam/logbookd/archive/$pkgver.tar.gz
	0001-Move-logread-binary-to-sbin.patch
	logbookd.initd
	logbookd.confd
	"
makedepends="cmake meson sqlite-dev util-linux-dev scdoc"

build() {
	abuild-meson . output
	meson compile -C output
}

check() {
	meson test -C output
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C output

	install -m755 -D "$srcdir"/logbookd.initd \
		"$pkgdir"/etc/init.d/logbookd
	install -m644 -D "$srcdir"/logbookd.confd \
		"$pkgdir"/etc/conf.d/logbookd
}


sha512sums="
a0edccb7bea46b86f22eadc835d4187a2cacdb38af7b66e60e83b6fdd7d6761dd25dacf3b98993fe35e24704806ea8a9a0d325be6390399867105bf1332505d9  logbookd-0.2.4.tar.gz
7a38f1c4dda5429fcca0c19a76a0ec79d83a831acfc44fd63e1b53994afc9ae3f03d3ac4c1dd7b574d97a921b87f07db144b8cb1975782c187323bdf3e6b3a1b  0001-Move-logread-binary-to-sbin.patch
9d4364793b751f26ae2eed51b7e4650b155b5ea0fc972235a952de0e7bcdef7b57f3357bb422de8ff1b59b5a4f6d82c8093e53ad2fc6290cea0a57921ed6f7ad  logbookd.initd
5c850daa2ae8c3e0852dbc9c4b2f89c09b01d0621181ac909de2272d44c1ca753cb5950cfc9f52db0d390df77497ec9f0612fd440326406a6d3ea4ccda783cb3  logbookd.confd
"
