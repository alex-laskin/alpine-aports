# Contributor: Galen Abell <galen@galenabell.com>
# Maintainer: Galen Abell <galen@galenabell.com>
pkgname=pass-otp
pkgver=1.2.0_git20250809
pkgrel=1
_commit="7bb50dbc4b6073f12f40be66a5ee371b9652a646"
pkgdesc="A pass extension for managing one-time-password (OTP) tokens"
url="https://github.com/tadfisher/pass-otp"
arch="noarch"
license="GPL-3.0-only"
depends="libqrencode oath-toolkit-oathtool"
subpackages="$pkgname-doc $pkgname-bash-completion $pkgname-passage"
source="pass-otp-$_commit.tar.gz::https://github.com/tadfisher/pass-otp/archive/$_commit.tar.gz"
options="!check" # fails due to old version
builddir="$srcdir/$pkgname-$_commit"

package() {
	make DESTDIR="$pkgdir" PREFIX="/usr" MANDIR="/usr/share/man" BASHCOMPDIR="/usr/share/bash-completion/completions" install
}

passage() {
	pkgdesc="Passage support for pass-otp"
	install_if="$pkgname=$pkgver-r$pkgrel passage"

	mkdir -p "$subpkgdir"/usr/lib/passage/extensions
	ln -s /usr/lib/password-store/extensions/otp.bash "$subpkgdir"/usr/lib/passage/extensions/
}

sha512sums="
f65937074a59e35ea8834f222ec981f7ee0c1c8e21638503dafecdbb3e0bbce0e798b5075d8260f7ddfe6d9d18687e43811e860e45495e88ebc4ad927dc61236  pass-otp-7bb50dbc4b6073f12f40be66a5ee371b9652a646.tar.gz
"
