# Contributor: Díaz Urbaneja Diego <sodomon2@gmail.com>
# Maintainer: Díaz Urbaneja Diego <sodomon2@gmail.com>
pkgname=ppsspp
pkgver=1.19.3
pkgrel=0
pkgdesc="PPSSPP - a fast and portable PSP emulator"
url="https://www.ppsspp.org/"
arch="aarch64 x86 x86_64 ppc64le" # other arches fail to build
license="GPL-2.0-only"
makedepends="
	cmake
	ffmpeg7-dev
	glew-dev
	libzip-dev
	mesa-dev
	miniupnpc-dev
	python3
	qt5-qtbase-dev
	qt5-qtmultimedia-dev
	samurai
	sdl2-dev
	sdl2_ttf-dev
	snappy-dev
	zlib-dev
	zstd-dev
	"
source="https://github.com/hrydgard/ppsspp/releases/download/v$pkgver/ppsspp-$pkgver.tar.xz"
options="!check" # make check not implemented

# This should avoid the segfault caused by switching between tabs on x86/x86_64 architectures.
case "$CARCH" in
	x86|x86_64) _use_egl_and_gles2=OFF;;
	*) _use_egl_and_gles2=ON ;;
esac


build() {
	cmake3.5 -B build-qt -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_BUILD_TYPE=Release \
		-DUSE_DISCORD=OFF \
		-DUSE_SYSTEM_FFMPEG=ON \
		-DUSE_SYSTEM_LIBPNG=ON \
		-DUSE_SYSTEM_LIBSDL2=ON \
		-DUSE_SYSTEM_LIBZIP=ON \
		-DUSE_SYSTEM_MINIUPNPC=ON \
		-DUSE_SYSTEM_SNAPPY=ON \
		-DUSE_SYSTEM_ZSTD=ON \
		-DUSING_QT_UI=ON \
		-DUSING_GLES2=$_use_egl_and_gles2 \
		-DUSING_EGL=$_use_egl_and_gles2 \
		-Wno-dev
	cmake --build build-qt
}

package() {
	DESTDIR="$pkgdir" cmake --install build-qt
}

sha512sums="
4c6af875cb3867bed8618fc289b5391fc49fbfcb884ccbc3fe7ad33b7cf3f2f538b3e4e6e01d5234dba12b64b2f1196c68f60c95d564286ca2e2626ffd9ecdaa  ppsspp-1.19.3.tar.xz
"
