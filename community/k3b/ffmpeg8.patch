From c10b680b224c0fb7ee77301b1532b0c5682004cc Mon Sep 17 00:00:00 2001
From: Heiko Becker <heiko.becker@kde.org>
Date: Mon, 15 Sep 2025 23:50:21 +0200
Subject: [PATCH] Fix build with ffmpeg >= 8

BUG: 509501
---
 plugins/decoder/ffmpeg/k3bffmpegwrapper.cpp | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/plugins/decoder/ffmpeg/k3bffmpegwrapper.cpp b/plugins/decoder/ffmpeg/k3bffmpegwrapper.cpp
index e8eeb4ba8..1e5deb207 100644
--- a/plugins/decoder/ffmpeg/k3bffmpegwrapper.cpp
+++ b/plugins/decoder/ffmpeg/k3bffmpegwrapper.cpp
@@ -161,7 +161,11 @@ void K3bFFMpegFile::close()
     ::av_packet_free(&d->packet);
 
     if( d->codec ) {
+#if LIBAVCODEC_VERSION_MAJOR >= 60
+        ::avcodec_free_context(&d->codecContext);
+#else
         ::avcodec_close(d->codecContext);
+#endif
         d->codec = nullptr;
         ::avcodec_free_context(&d->codecContext);
         d->codecContext = nullptr;
-- 
GitLab

