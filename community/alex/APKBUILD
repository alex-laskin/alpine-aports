# Contributor: River Dillon <oss@outerpassage.net>
# Maintainer: Celeste <cielesti@protonmail.com>
maintainer="Celeste <cielesti@protonmail.com>"
pkgname=alex
pkgver=3.5.4.0
pkgrel=0
pkgdesc="Lexical analyser generator for Haskell"
url="https://www.haskell.org/alex/"
arch="x86_64 aarch64 loongarch64" # limited by ghc
license="BSD-3-Clause"
case "$CARCH" in
loongarch64)
	makedepends="ghc-loongarch-cmds"
	options="!check"
	;;
*)	makedepends="ghc" ;;
esac
makedepends="$makedepends libffi-dev"
subpackages="$pkgname-doc"
source="https://hackage.haskell.org/package/alex-$pkgver/alex-$pkgver.tar.gz"

build() {
	runhaskell Setup.hs configure \
		"--prefix=/usr" \
		"--datasubdir=$pkgname" \
		"--docdir=\$datadir/doc/$pkgname" \
		"--enable-tests"
	runhaskell Setup.hs build -j "--ghc-options=-j -O1"
}

check() {
	runhaskell Setup.hs test
}

package() {
	runhaskell Setup.hs copy "--destdir=$pkgdir"
}

sha512sums="
a2f31537cd295858630d2d2e3d55c9fb0a4c565ca0c1833a003ba975faa2c81693773b6fc29f526cf0535e5db81952f22d45efa48df1bf6ff02d5afe462bfaa6  alex-3.5.4.0.tar.gz
"
