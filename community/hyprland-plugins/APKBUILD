# Contributor: Jean-Louis Fuchs <safe.pen2857@rhizoome.ch>
# Maintainer: Jean-Louis Fuchs <safe.pen2857@rhizoome.ch>
pkgname=hyprland-plugins
pkgver=0.51.0
pkgrel=0
_pkgdesc="Official plugins for Hyprland"
pkgdesc="$_pkgdesc (all plugins)"
_hyprlandver="~0.51"
url="https://github.com/hyprwm/hyprland-plugins"
arch="all"
license="BSD-3-Clause"
makedepends="
	aquamarine-dev
	cmake
	samurai
	hyprgraphics-dev
	hyprlang-dev
	hyprland-dev
	hyprutils-dev
	libdrm-dev
	libinput-dev
	libxkbcommon-dev
	xcb-util-wm-dev
	mesa-dev
	pango-dev
	pixman-dev
	wayland-dev
"
subpackages="$pkgname-doc"
options="!check" # currently there are no tests
source="
	https://github.com/hyprwm/hyprland-plugins/archive/v$pkgver/hyprland-plugins-v$pkgver.tar.gz
	"
_plugins="
	borders-plus-plus
	csgo-vulkan-fix
	hyprbars
	hyprexpo
	hyprfocus
	hyprscrolling
	hyprtrails
	hyprwinwrap
	xtra-dispatchers
"
depends="hyprland$_hyprlandver"

for plugin in $_plugins; do
	subpackages="$subpackages $pkgname-$plugin:_subpkg_func"
	depends="$depends $pkgname-$plugin"
done

build() {
	for plugin in $_plugins; do
		cd "$builddir/$plugin"
		cmake -B build -G Ninja \
			-DCMAKE_INSTALL_PREFIX=/usr \
			-DCMAKE_INSTALL_LIBDIR=lib \
			-DCMAKE_BUILD_TYPE=None
		cmake --build build
	done
}

package() {
	install -Dm0644 -t "$pkgdir/usr/share/licenses/$pkgname/" LICENSE
}

# Generic subpkg handler
_subpkg_func() {
	local plugin="${subpkgname#"$pkgname-"}"
	pkgdesc="Official plugins for Hyprland ($plugin)"
	depends="hyprland$_hyprlandver"

	cd "$builddir/$plugin"
	DESTDIR="$subpkgdir" cmake --install build
	install -Dm0644 -t "$pkgdir-doc/usr/share/doc/$subpkgname/" README.md
}

sha512sums="
2cd34cce30f364abcd572f678a97a206f5c1c2eee60ed6ee43383ae7514745f00dd2c57f19d226d61a93b665edef5ae4d96b4ff6fc11da77bfa2307a0bef9a3f  hyprland-plugins-v0.51.0.tar.gz
"
