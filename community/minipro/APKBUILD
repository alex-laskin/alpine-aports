# Contributor: Bryce Vandegrift <bryce@brycevandegrift.xyz>
# Maintainer: Bryce Vandegrift <bryce@brycevandegrift.xyz>
pkgname=minipro
pkgver=0.7.4
pkgrel=1
pkgdesc="Program for controlling the MiniPRO TL866xx series of chip programmers"
url="https://gitlab.com/DavidGriffith/minipro"
arch="all"
license="GPL-3.0-or-later"
depends="libusb"
makedepends="git libusb-dev zlib-dev"
subpackages="$pkgname-doc $pkgname-bash-completion $pkgname-udev"
options="!check" # no test suite
# upstream uses git placeholders that generate unstable tarballs
# https://gitlab.com/DavidGriffith/minipro/-/issues/357
source="$pkgname-$pkgver-1.tar.gz::https://gitlab.com/DavidGriffith/minipro/-/archive/$pkgver/minipro-$pkgver.tar.gz"

build() {
	make -e PREFIX="/usr"
}

package() {
	make -e DESTDIR="$pkgdir" PREFIX="/usr" COMPLETIONS_DIR="/usr/share/bash-completion/completions" install
}

udev() {
	pkgdesc="$pkgdesc (udev rules)"
	install_if="$pkgname=$pkgver-r$pkgrel udev"

	cd "$builddir"
	install -Dm644 udev/60-minipro.rules -t "$subpkgdir"/usr/lib/udev/rules.d
	install -Dm644 udev/61-minipro-plugdev.rules -t "$subpkgdir"/usr/lib/udev/rules.d
	install -Dm644 udev/61-minipro-uaccess.rules -t "$subpkgdir"/usr/lib/udev/rules.d
}

sha512sums="
773b7f279dd8dee8a107545e26541eebf80d024ad4a1ff64260697cdbb2cab16520f36d66d3060a148a9fafed52e41c44b2f00c33af8c1493186e67a909ecc89  minipro-0.7.4-1.tar.gz
"
