# Contributor: Olliver Schinagl <oliver@schinagl.nl>
# Maintainer: Olliver Schinagl <oliver@schinagl.nl>
pkgname=nxp-mfgtools
pkgver=1.5.233
pkgrel=0
pkgdesc="Freescale/NXP i.MX Chip image deploy tools"
url="https://github.com/NXPmicro/mfgtools"
arch="all"
license="LGPL-2.1-only"
options="!check" # No tests available
subpackages="$pkgname-uuu lib$pkgname-static lib$pkgname-dev"
makedepends="
	bzip2-dev
	cmake
	libusb-dev
	libzip-dev
	openssl-dev>3
	samurai
	tinyxml2-dev
	zstd-dev
	"
source="$pkgname-$pkgver.tar.gz::https://github.com/nxp-imx/mfgtools/archive/refs/tags/uuu_$pkgver.tar.gz
	lfs64.patch
	"
builddir="$srcdir/mfgtools-uuu_$pkgver/"

prepare() {
	default_prepare
	echo "$pkgver" > "$builddir/.tarball-version"
}

build() {
	cmake -B build -G Ninja \
		-DCMAKE_BUILD_TYPE=None \
		-DCMAKE_INSTALL_PREFIX=/usr
	cmake --build build
}

package() {
	depends="$subpackages"

	DESTDIR="$pkgdir" cmake --install build

	install -Dm644 build/libuuu/libuuc_s.a "$pkgdir/usr/lib/libuuc_s.a"
	install -Dm644 libuuu/libuuu.h "$pkgdir/usr/include/libuuu.h"
}

uuu() {
	amove usr/bin/uuu
}

sha512sums="
88b5375dbf61ecc25026698d0bc118ab29f7e6b76142d4a14b508f5d483f5cbf525f9cb4b730e32768a7bb92821d81ce3f43d65764de59884573a56bac0a5e18  nxp-mfgtools-1.5.233.tar.gz
47f6743eae55f9570ba33e06388c533338129b66848e009d38e4b752a998dba583aa4409bd54ef4890004adba41837ce3ec17bbedfda0a5c85a8b4276b4c4af4  lfs64.patch
"
