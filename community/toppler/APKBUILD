# Maintainer: Antoni Aloy <aaloytorrens@gmail.com>
pkgname=toppler
pkgver=1.3
pkgrel=1
pkgdesc="Clone of the Nebulus game on old 8 and 16 bit machines"
url="https://gitlab.com/roever/toppler"
arch="all !riscv64"  # Assembler error
license="GPL-2.0-only"
depends="$pkgname-data"
makedepends="sdl2-dev sdl2_image-dev sdl2_mixer-dev gettext-dev libpng-dev"
source="
	https://gitlab.com/roever/toppler/-/archive/v1.3/toppler-v$pkgver.tar.gz
	gcc-14.patch
	remove-string_view-clamp.patch
	clang-21.patch
	skip-tooling.patch
	disable-nls.patch
	toppler.desktop
"
subpackages="$pkgname-data::noarch $pkgname-doc"
builddir="$srcdir/$pkgname-v$pkgver"
options="!check"  # No testsuite

build() {
	make
}

package() {
	make DESTDIR="$pkgdir" install
	install -Dm644 "$srcdir"/toppler.desktop \
		"$pkgdir"/usr/share/applications/toppler.desktop
	install -Dm644 "$builddir"/dist/toppler.xpm \
		"$pkgdir"/usr/share/pixmaps/toppler.xpm
	install -Dm644 "$builddir"/dist/toppler40.xpm \
		"$pkgdir"/usr/share/pixmaps/toppler40.xpm
}

data() {
	pkgdesc="$pkgdesc (data files)"
	amove usr/share/toppler
}

sha512sums="
e12c15e881fa606f972817f6906d34ebb369b8fcb93c1fcbc0cb017b1002ba35cfe0dfece69d57da9ffa13557e935eb483db94e574cff0aa6438f50f6a263ffd  toppler-v1.3.tar.gz
1873805f0495092d335289f1f47f29d1140aeba799df027f1858256406e3c2984d96485b3c4b564e93c9bddacdc60a3ab8aab3f61994b84972f56c85f0abc844  gcc-14.patch
24219d6296e4ee43cb98dc0d22aae37053cfd1f354f0083cae1986bdb0b48b7256a8f508032788cd92e06e89aee019a5b32ea3c0ca66bc55a37c623a84e0a2eb  remove-string_view-clamp.patch
8f26393ffeb6830d8ad49681a68830d02c3d90ea00caa31aba555a77ec84eb90c38b0a221583eef53a1602920db6d3affb8a7c2702c39a62134dbaa11ec70c25  clang-21.patch
9b9be5db069c777d56797aaa45d1a87c91b93898f1604e06e27444d0ab7ddf83f1f02a3a351323b625500813de4d724eef36e760b011f6e9f9424e53d1ce2835  skip-tooling.patch
d3aec880a56931fd7d5e28d7eb06baac2dddb16f4d7df675568d405b78d3dd63689aa8240c7252fbe206ea3f28326730bbad355fbe26494f749c82fbabe0e07d  disable-nls.patch
bed53b15f35ab066248885116d0de5977668bd0dcbf25cd2e203b6b2d6b8a51a9c3f8683c00461efa74c32c05b57547e7397d73b58f0f46fc64620c479885cc6  toppler.desktop
"
