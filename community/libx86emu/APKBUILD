# Contributor: Jakub Jirutka <jakub@jirutka.cz>
# Maintainer: Jakub Jirutka <jakub@jirutka.cz>
pkgname=libx86emu
pkgver=3.7
pkgrel=0
pkgdesc="x86 emulation library"
url="https://github.com/wfeldt/libx86emu"
# libx86emu performs direct port I/O, which only works on x86
# platforms.
arch="x86 x86_64"
license="MIT"
subpackages="$pkgname-dev"
source="$pkgname-$pkgver.tar.gz::https://github.com/wfeldt/libx86emu/archive/$pkgver.tar.gz"
options="!check"  # FIXME: test fails to build

_flags="VERSION=$pkgver MAJOR_VERSION=${pkgver%%.*} GIT2LOG= LIBDIR=/usr/lib"

build() {
	make shared $_flags CFLAGS="$CFLAGS -fPIC -Wall"
}

check() {
	make test $_flags CFLAGS="$CFLAGS -I../include"
}

package() {
	make $_flags DESTDIR="$pkgdir" install
}

sha512sums="
e93db0f32d9e83f7f5f87753f1afb70add90bc033bc71e92fbe551608153a8ae7f1fe5c2900523445cb473ea7c1e26a8296f11a8cf248a816f3c5bf450a7b99c  libx86emu-3.7.tar.gz
"
