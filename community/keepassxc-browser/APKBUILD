# Contributor: Hugo Osvaldo Barrera <hugo@whynothugo.nl>
maintainer="Hugo Osvaldo Barrera <hugo@whynothugo.nl>"
pkgname=keepassxc-browser
pkgver=1.9.7
pkgrel=1
pkgdesc="KeePassXC Browser Extension"
url="https://github.com/keepassxreboot/keepassxc-browser/"
arch="noarch"
license="GPL-3.0-or-later"
makedepends="npm"
source="keepassxc-browser-$pkgver.tar.gz::https://github.com/keepassxreboot/keepassxc-browser/archive/refs/tags/$pkgver.tar.gz"
options="!check net" # no tests, build fetches assets

prepare() {
	default_prepare
	npm ci
}

build() {
	# fetching translations requires a user account (and unmet dependencies).
	npm run build -- --skip-translations
}

package() {
	# See: https://github.com/keepassxreboot/keepassxc-browser/issues/2634

	_target="$pkgdir/usr/lib/firefox/browser/extensions/keepassxc-browser@keepassxc.org"
	mkdir -p "$_target"
	tar -xf keepassxc-browser_${pkgver}_firefox.zip -C "$_target"
}

sha512sums="
0c934b320e9ca9e7d3e7e50caa57998382acb23f562abcb083f85f06fcafff1229198383c45f741b8880a55d8c8bd7181d520c5f4a6aa3667890c666d1426206  keepassxc-browser-1.9.7.tar.gz
"
