# Contributor: Marian Buschsieweke <marian.buschsieweke@posteo.net>
# Contributor: Holger Jaekel <holger.jaekel@gmx.de>
# Maintainer: Marian Buschsieweke <marian.buschsieweke@posteo.net>
pkgname=qwt
pkgver=6.3.0
pkgrel=0
pkgdesc="Qt Widgets for Technical Applications"
url="https://qwt.sourceforge.io/"
arch="all"
license="custom" # Based on LGPL but more liberal
makedepends="
	qt5-qtbase-dev qt5-qtsvg-dev qt5-qttools-dev
	qt6-qtbase-dev qt6-qtsvg-dev qt6-qttools-dev
	doxygen m4 graphviz
	"
subpackages="
	$pkgname-dev
	$pkgname-doc
	qt5-$pkgname-designer:qt5_designer
	qt6-$pkgname-designer:qt6_designer
	qt5-$pkgname:qt5
	qt6-$pkgname:qt6
	"
source="https://downloads.sourceforge.net/qwt/qwt-$pkgver.tar.bz2
	10_install_paths.patch
	20_fix_rpath.patch
	30_multibuild.patch
	40_manpages.patch
	"

options="!check" # no unit tests

prepare() {
	default_prepare
	cp -ar "$builddir" "$srcdir/qwt-$pkgver-qt5"
	mv "$builddir" "$srcdir/qwt-$pkgver-qt6"
}

build() {
	cd "$builddir-qt5"
	qmake-qt5 qwt.pro
	make
	cd doc
	doxygen

	cd "$builddir-qt6"
	qmake6 qwt.pro
	make
}

package() {
	cd "$builddir-qt5"
	make INSTALL_ROOT="$pkgdir" install

	mv "$builddir-qt5/doc/man" "$pkgdir/usr/share"
	install -Dm 644 COPYING -t "$pkgdir/usr/share/licenses/$pkgname"

	cd "$builddir-qt6"
	make INSTALL_ROOT="$pkgdir" install
}

qt5_designer() {
	pkgdesc="$pkgdesc (Qt5 designer plugin)"
	depends="qt5-$pkgname=$pkgver-r$pkgrel"

	amove usr/lib/qt5/plugins/designer
}

qt6_designer() {
	pkgdesc="$pkgdesc (Qt6 designer plugin)"
	depends="qt5-$pkgname=$pkgver-r$pkgrel"

	amove usr/lib/qt6/plugins/designer
}

qt5() {
	amove usr/lib/*qt5.so*
}

qt6() {
	amove usr/lib/*qt6.so*
}

sha512sums="
fa90686058f5008f6d0365d24a74481bd642e9126d82291f27a5218b684bdcf008ef5e9293b52c5c7d85e9b42027459527be373726e8376a3f707ec85e483064  qwt-6.3.0.tar.bz2
70fd01facc2f5e5fa91131f6fb2278d01cd73e0d0982837125d20e732616680d548834ee8a0a2e049437bb64f389b2bc95c8c366bcafc91f09a5181d86cd938d  10_install_paths.patch
f0ebdc2e90c318f8c9a2aa925234b85e328611d3713939066e71494b912dde5bd99c328ef2ae0de606603da461377ea43da960c617d064c85c4488e2934eb4e5  20_fix_rpath.patch
2b17fa078285e9cfe3e78254b563ca4e385ed162ab817ff4d2659dd0353309f764bcf13d0e1a3dcfb0987d3efc42dbc0072d95fda8d9da48a271cf752c0869d8  30_multibuild.patch
712f71ef99eb1ad71d15d0fea548262f7628bba67257e99a2927b7da9f049a788ad1dd271fe45a0922fd5b46c0e111c7d5351894ae8657b980e24b548d6324fc  40_manpages.patch
"
