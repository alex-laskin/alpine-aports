# Contributor: Will Sinatra <wpsinatra@gmail.com>
# Contributor: mio <miyopan@e.email>
# Maintainer: Will Sinatra <wpsinatra@gmail.com>
pkgname=pilot-link
pkgver=0.12.5_git20241124
_commit="f57d2267e26125b0281abadf09caac6a257d7d75"
pkgrel=2
pkgdesc="A suite of tools for connecting to PalmOS handheld devices"
url="https://github.com/desrod/pilot-link"
license="GPL-2.0-only"
arch="all"
makedepends="
	libtool
	autoconf
	automake
	bison
	popt-dev
	bluez-dev
	libpng-dev
	libusb-dev
	readline-dev
	linux-headers
	gnu-libiconv-dev
	libxslt
	docbook-xml
	docbook-xsl
	"
source="${pkgname}_$_commit.tar.gz::https://github.com/desrod/pilot-link/archive/$_commit.tar.gz
	config.guess
	config.sub
	pilot-link-png14.patch
	fix-printf-string-literals.patch
	fix-configure-checks.patch
	fix-doc-generation.patch
	gcc14.patch
	gcc15.patch
	"
builddir="$srcdir/$pkgname-$_commit"
subpackages="$pkgname-doc $pkgname-dev $pkgname-libs"

prepare() {
	cp "$srcdir/config.guess" "$builddir/"
	cp "$srcdir/config.sub" "$builddir/"
	default_prepare
	update_config_sub
	update_config_guess
}

build() {
	./autogen.sh \
			--prefix=/usr \
			--enable-conduits \
			--enable-libusb \
			--with-libiconv \
			--with-libpng

	make

	#Build man pages
	cd "$builddir/doc/xml"
	LIBXSLTPROC="xsltproc" make
}

check() {
	make check
}

package() {
	depends="$pkgname-libs"
	make DESTDIR="$pkgdir" install

	cd "$builddir/doc/man"
	make DESTDIR="$pkgdir" install
}

sha512sums="
0cf8ac2f9404f8d8d06496597c1cabf611021859c3179038d937396d3fa583789564b2d36d42240661dc48ff29d68cf012d4ac494fa273445772ed77e72d46e9  pilot-link_f57d2267e26125b0281abadf09caac6a257d7d75.tar.gz
e9a80021a526299995e21094d76810a21d3982c00020f13a3c7527ba2b83459863f4f8eeb3b1ee7a4f1e2ff6c51d7b5e8ae2a6ce719392cf676ae848599117b3  config.guess
0ec40128c1ef50e47432ee4ebbb4ea6d2feaa411ff518626c4181b0302c5d0ff4095aaf36e433a216ce1bd5bb03ba416645a46ef3c916718761f9a21f5bdcbfd  config.sub
cf37e4b51d261431f42054cf05d1603e66d8eca0604ae042371c7284c8e668f49cadb3d75cf67eaf56008809d3cc2766615105658293a90cada37bdf3f553f41  pilot-link-png14.patch
359cf02da308bbd9d24716ac022738598de03befd18932ba1f827e51320650ed36da5fcd203a4adaa8d04a98d4f84aac61e594320af1fc316873a9c06d1fb147  fix-printf-string-literals.patch
f68d98c4cc458cc5c030af2c8bcb9e9cffda1408b3fa0b9f4679098123fe11a63a92f222cb2a7f6195f130201f293dbd5fee5b84ec65f22ac09f33e43448ffe8  fix-configure-checks.patch
69ff818c11733b0f10ceff369ab425338230e8037771a62398d522dac8c5183cb468d86cf6da2305eed6ae0f1ad76969b9f0e752044df6176e322fcaab5f1ce8  fix-doc-generation.patch
e64519f9e60d66d4831f92e1523fbd11a1e6c8da644e019430d0d9b203a4211726bc6ddf40d7584eda444146559f17e32ef6a63e526ce4c954acb5a69d19bbe7  gcc14.patch
211855ea67000db591f8dc0c61d15231e3f032782cd68d389fcc5d5e58db71c9a865f887c9835fd9486457d596d864c395a7ffc0f4976ebc5efe5c95b86bfa42  gcc15.patch
"
