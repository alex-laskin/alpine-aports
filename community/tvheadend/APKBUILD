# Contributor: Carlo Landmeter <clandmeter@alpinelinux.org>
maintainer="Achill Gilgenast <achill@achill.org>"
pkgname=tvheadend
# they use a "rolling release" model
pkgver=4.3_git20251018
_commit=7de8bf4826b1847118f3a42556cf0afeee2a5912
pkgrel=0
pkgdesc="TV Streaming server for linux"
url="https://tvheadend.org/"
arch="all"
license="GPL-3.0-only"
makedepends="
	bash
	bsd-compat-headers
	cmake
	coreutils
	ffmpeg-dev
	findutils
	gettext-dev
	git
	libdvbcsa-dev
	libvpx-dev
	linux-headers
	openssl-dev
	opus-dev
	python3
	uriparser-dev
	wget
	x264-dev
	x265-dev
	zlib-dev
	"
pkgusers="tvheadend"
pkggroups="video"
install="$pkgname.pre-install"
options="!check" # no testsuites
subpackages="$pkgname-doc $pkgname-openrc"
source="$pkgname-$pkgver.tar.gz::https://github.com/tvheadend/tvheadend/archive/$_commit.tar.gz
	$pkgname.initd
	"
builddir="$srcdir/$pkgname-$_commit"

build() {
	./configure \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info \
		--localstatedir=/var \
		--disable-execinfo \
		--enable-libav \
		--disable-ffmpeg_static \
		--disable-libx264_static \
		--disable-libx265_static \
		--disable-libvpx_static \
		--disable-libtheora_static \
		--disable-libvorbis_static \
		--disable-libfdkaac_static \
		--disable-libmfx_static \
		--python=python3 \
		--nowerror
	make
}

package() {
	make DESTDIR="$pkgdir" install
	install -Dm755 "$srcdir"/$pkgname.initd \
		"$pkgdir"/etc/init.d/$pkgname
	install -dm755 -o $pkgusers -g $pkggroups \
		"$pkgdir"/etc/tvheadend \
		"$pkgdir"/var/lib/tvheadend \
		"$pkgdir"/var/log/tvheadend
}

sha512sums="
06cab966eb0e0fa6eac1e690be2e05bb08800a30dcf736c96d63ed966083f0ad7141dbba7b88fa1c99d12cc31dd8065bf87731502c1ec62f92ba5170cf540ee9  tvheadend-4.3_git20251018.tar.gz
8b6463996b9635654cba4458e58cef2970e31c98c1469ccc694276e5542eec451a0859a972b6c056b53d97deb2cef55d701fb1ee3ca980b1606f9126a88ab64f  tvheadend.initd
"
