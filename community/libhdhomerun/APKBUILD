# Contributor: Hasse Hagen Johansen <hasse-docker@hagenjohansen.dk>
# Maintainer: Hasse Hagen Johansen <hasse-docker@hagenjohansen.dk>
pkgname=libhdhomerun
pkgver=20250815
pkgrel=0
pkgdesc="Library for Silicon Dust HD HomeRun"
options="!check" # No testsuite
url="https://github.com/Silicondust/libhdhomerun"
arch="all"
license="LGPL-2.1-or-later"
depends="$pkgname-libs"
depends_dev="$pkgname-libs"
makedepends="linux-headers"
subpackages="$pkgname-dev $pkgname-libs"
source="http://download.silicondust.com/hdhomerun/libhdhomerun_$pkgver.tgz
	nlmsg_len.patch
	"
builddir="$srcdir/$pkgname"

build() {
	make STRIP=:
}

package() {
	install -Dm755 hdhomerun_config \
		"$pkgdir"/usr/bin/hdhomerun_config
	for i in *.h; do
		install -Dm644 $i \
			"$pkgdir"/usr/include/libhdhomerun/$i
	done
}

# libhdhomerun does not provide versioned libs so we cannot
# use abuilds libs split function, so we make our own.
libs() {
	pkgdesc="$pkgname (libraries)"
	depends=
	install -Dm755 "$builddir"/libhdhomerun.so \
		"$subpkgdir"/usr/lib/libhdhomerun.so
}

sha512sums="
6216076924f2b265c03353460cbd23f914b217ac5b8de2ea153be7bdfb2b7ea93926c6f4d956103493274410240905d754d17a7bad209fbc183fa3cf51271478  libhdhomerun_20250815.tgz
130884448b7d593b2080b06943cb56dc986e07aff2d752a64f12eb6d85fe61d6db1effd14317d501ecb65dbdd888eb25d2e957bd5c7303a51a2205181f144c61  nlmsg_len.patch
"
