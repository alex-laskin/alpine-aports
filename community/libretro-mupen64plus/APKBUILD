# Contributor: Bart Ribbers <bribbers@disroot.org>
# Maintainer: David Demelier <markand@malikania.fr>
pkgname=libretro-mupen64plus
pkgver=0_git20250820
pkgrel=0
_commit="222acbd3f98391458a047874d0372fe78e14fe94"
arch="x86_64" # Seems to be broken on non 64-bit platforms
url="https://github.com/libretro/mupen64plus-libretro-nx"
pkgdesc="libretro port of Mupen64 Plus with GLideN64"
license="GPL-2.0-or-later"
makedepends="mesa-dev zlib-dev libpng-dev nasm"
source="$pkgname-$pkgver.tar.gz::https://github.com/libretro/mupen64plus-libretro-nx/archive/$_commit.tar.gz
	gcc14.patch
	gcc15.patch
	"
builddir="$srcdir/mupen64plus-libretro-nx-$_commit"
options="!check" # No tests

build() {
	case "$CARCH" in
		x86)
			WITH_DYNAREC=x86 make
			;;
		x86_64)
			WITH_DYNAREC=x86_64 make
			;;
		armhf|armv7|aarch64)
			WITH_DYNAREC=arm make
			;;
	esac
}

package() {
	install -Dm644 mupen64plus_next_libretro.so "$pkgdir"/usr/lib/libretro/mupen64plus_next_libretro.so
}

sha512sums="
33139a21fde5e84b70c87bc9ce092031bf9bac745d21ddb1ffbde2c7806c492993f17dc597fd366ebb842a20e6e2b4b8c0d79ef7321dd3f43b12b35414c662ae  libretro-mupen64plus-0_git20250820.tar.gz
7df979068c6fc900bed3cbab6b51b7e042929dc745f140394e879d121e1ffd2b733f4748a4a9942531272ed21e6671d99c9bc63dce4dbfa7737dc635201fa6b8  gcc14.patch
e59b9346169a364409cfc338f0ffd767aef49ce2de19ac9eb8f0d681f7aaf64c74d657e215eb8a8f1c6d0ba3d399024ea36f54c69c4906a669eaf42a19162e1f  gcc15.patch
"
