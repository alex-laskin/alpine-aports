# Contributor: Matthias Ahouansou <matthias@ahouansou.cz>
# Maintainer: Matthias Ahouansou <matthias@ahouansou.cz>
pkgname=codeberg-cli
pkgver=0.5.1
pkgrel=0
pkgdesc="CLI Tool for Codeberg similar to gh and glab"
url="https://codeberg.org/RobWalt/codeberg-cli"
arch="all"
license="AGPL-3.0-or-later"
makedepends="
	cargo
	cargo-auditable
	openssl-dev
"
subpackages="
	$pkgname-bash-completion
	$pkgname-fish-completion
	$pkgname-zsh-completion
"
source="$pkgname-$pkgver.tar.gz::https://codeberg.org/RobWalt/codeberg-cli/archive/v$pkgver.tar.gz"
builddir="$srcdir/$pkgname"
options="net !check" # no tests

prepare() {
	default_prepare
	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --release --frozen
}

package() {
	install -Dm755 target/release/berg -t "$pkgdir"/usr/bin

	mkdir -p "$pkgdir"/usr/share/bash-completion/completions
	mkdir -p "$pkgdir"/usr/share/fish/vendor_completions.d
	mkdir -p "$pkgdir"/usr/share/zsh/site-functions

	target/release/berg completion bash > "$pkgdir"/usr/share/bash-completion/completions/berg
	target/release/berg completion fish > "$pkgdir"/usr/share/fish/vendor_completions.d/berg.fish
	target/release/berg completion zsh > "$pkgdir"/usr/share/zsh/site-functions/_berg
}

sha512sums="
e7eb674002c26828209c2112637105d17cdfd439a0420860346a1743a3118c4f2aac8c48fc4569cf76d0f1b4a00f220eb016aa7a81d37e79935ee73d9c0a67b5  codeberg-cli-0.5.1.tar.gz
"
