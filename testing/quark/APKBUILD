# Contributor: Christiano Haesbaert <haesbaert@haesbaert.org>
# Maintainer: Christiano Haesbaert <haesbaert@haesbaert.org>
pkgname=quark
pkgver=0.5
pkgrel=0
pkgdesc="BPF system events monitor"
url="https://github.com/elastic/quark"
arch="x86_64 aarch64"
license="Apache-2.0"
makedepends="bpftool clang elfutils-dev libbpf-dev linux-headers musl-fts-dev zlib-dev"
subpackages="$pkgname-doc"
source="$pkgname-$pkgver.tar.gz::https://github.com/elastic/quark/archive/refs/tags/v$pkgver.tar.gz"
# All tests require loading BPF probes that require priviledges
options="!check"

build() {
	make	V=1							\
		SHELL=/bin/sh						\
		SYSLIB=y						\
		CFLAGS="$CFLAGS -fno-strict-aliasing -Wno-error=inline"	\
		quark-mon						\
		quark-test
}

package() {
	install -c -m 755 -D quark-mon quark-test -t "$pkgdir"/usr/bin
	install -c -m 644 -D quark-mon.8 quark-test.8 -t "$pkgdir"/usr/share/man/man8
}

sha512sums="
3a5f267ede514cf6a761420c4c4767e45a078beb32eeeff27ce4abc1b28ca8ddb32f12937e546f5ad994408ba6606739b76aa620a1c752d0502bb555fa125c2f  quark-0.5.tar.gz
"
