# Contributor: Francesco Colista <fcolista@alpinelinux.org>
# Maintainer: Francesco Colista <fcolista@alpinelinux.org>
pkgname=libre
pkgver=4.1.0
pkgrel=0
pkgdesc="Portable library for real-time communications"
url="https://github.com/baresip/re"
arch="all"
license="BSD-3-Clause"
makedepends="openssl-dev zlib-dev cmake linux-headers samurai"
subpackages="$pkgname-dev"
source="$pkgname-$pkgver.tar.gz::https://github.com/baresip/re/archive/v$pkgver.tar.gz"

builddir="$srcdir/re-$pkgver"

build() {
	cmake -B build -G Ninja -DCMAKE_BUILD_TYPE='None' -DCMAKE_INSTALL_PREFIX='/usr' -Wno-dev
	cmake --build build
}

check() {
	cmake --build build --parallel -t retest
		build/test/retest -rv
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
a3f2b8bfc4c017bc937c4a81b6003f994360874a6a4f7a395079e3ab25d29512e6c275d0db3eb04d48c4cc928d2b05781dc7ac79f073d054ff43bdf87cf09688  libre-4.1.0.tar.gz
"
