# Contributor: Adam Thiede <me@adamthiede.com>
# Maintainer: Adam Thiede <me@adamthiede.com>
pkgname=gtypist
pkgver=2.10.1
#_commit="9a458f08b9ea43cb66488771abcad23ce9f46b2a"
pkgrel=0
pkgdesc="Universal typing tutor"
url="https://www.gnu.org/software/gtypist/gtypist.html"
arch="all !x86 !loongarch64 !armv7" # fails to build on 32bit and loongarch
license="GPL-3.0-or-later"
depends="ncurses perl"
makedepends="autoconf gengetopt automake gettext-dev texinfo gawk libncursesw ncurses-dev perl help2man"
subpackages="$pkgname-doc $pkgname-lang"

# ncursesw.patch: use ncurses in favor of ncursesw, like Arch
# https://aur.archlinux.org/cgit/aur.git/tree/gtypist_ncurses_is_ncursesw.patch?h=gtypist
# getopt.patch: remove bundled getopt from makefile
source="
	https://ftp.gnu.org/gnu/gtypist/gtypist-$pkgver.tar.gz
	ncursesw.patch
	getopt.patch
"

build() {
	# we're not using glibc
	CFLAGS="$CFLAGS -D_GNU_SOURCE=0"
	# need to remove bundled getopt files too
	rm src/getopt*
	./autogen.sh --prefix=/usr
	make
}

check() {
	make check
}

package() {
	make prefix="$pkgdir/usr" install
}

sha512sums="
7fa8554b5710d82fc40bb8dd1ee31b25cb137402bacd687b742f7b91511765612106578f34151b39926e251d900a3cb810a268cfbb98dc4357901d91aefaccec  gtypist-2.10.1.tar.gz
83fdbf5853b5c86a2cc6f52235c9a0f6710a5a6136777f5de62b484998758f12fbc57419a74188f3988f19d145b72990df737c0c5607d7ecb33f0f2b9ea9fe99  ncursesw.patch
4a1849ce08d12f0f941003a8da08a8b77829298f650efb9220d9fb07cfccf744a80305275a2a93d49b8d292dcc8c0028dc6fd66850af9145e19a2e1fbb03841a  getopt.patch
"
