# Maintainer: Celeste <cielesti@protonmail.com>
maintainer="Celeste <cielesti@protonmail.com>"
pkgname=fungw
pkgver=1.2.2
pkgrel=0
pkgdesc="C function gateway for different programming languages"
url="http://www.repo.hu/projects/fungw/"
arch="all"
license="LGPL-2.1-or-later"
makedepends="
	duktape-dev
	lua5.1-dev
	mujs-dev
	perl-dev
	python3-dev
	tcl-dev
	"
checkdepends="dash-binsh"
subpackages="
	$pkgname-c:_plugin
	$pkgname-cli:_plugin
	$pkgname-duktape:_plugin
	$pkgname-fawk:_plugin
	$pkgname-lua:_plugin
	$pkgname-mujs:_plugin
	$pkgname-perl:_plugin
	$pkgname-python3:_plugin
	$pkgname-tcl:_plugin
	$pkgname-dev
	$pkgname-doc
	"
source="http://www.repo.hu/projects/fungw/releases/fungw-$pkgver.tar.gz"

build() {
	./configure --prefix=/usr
	make
}

check() {
	cd regression
	local l; for l in bas fawk js lua pas pl py3 sh tcl; do
		SCRIPT=../doc/example/00_hello/hello.$l ./test_script 
	done
}

package() {
	make DESTDIR="$pkgdir" install
}

_plugin() {
	local name=${subpkgname#"$pkgname"-}
	pkgdesc="$pkgdesc ($name plugin)"
	depends="$pkgname=$pkgver-r$pkgrel"

	case "$name" in
		cli|fawk) install_if="$pkgname=$pkgver-r$pkgrel" ;;
	esac

	amove \
		usr/lib/libfungw_${name}.* \
		usr/lib/puplug/fungw_${name}.*
}

sha512sums="
f56076adcad535e740df6e5a912ab0f3452d4aa442d4b6f1d7912405b674922c5f9452a90fa3e9bec65d964a81c0bdcf9fb7883591318802d0dfc07ee64e7065  fungw-1.2.2.tar.gz
"
