maintainer="Michał Polański <michal@polanski.me>"
pkgname=rust-script
pkgver=0.36.0
pkgrel=0
pkgdesc="Run Rust files and expressions as scripts without any setup or compilation step"
url="https://rust-script.org/"
license="Apache-2.0 OR MIT"
arch="all !armhf" # tests hang
makedepends="cargo cargo-auditable"
source="https://github.com/fornwall/rust-script/archive/$pkgver/rust-script-$pkgver.tar.gz
	loongarch64-downgrade-libc.patch
	"
options="net"

prepare() {
	default_prepare

	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --frozen --release
}

check() {
	cargo test --frozen
}

package() {
	install -Dm755 target/release/$pkgname -t "$pkgdir"/usr/bin/
}

sha512sums="
0b194bb545a5633710b9c7a71351dadff63c9d9cb6e0464bcbe8a9c11e9a1e62e5d0dde47300b032a5e2c9e3910a29bf8300bec749ebbba509d8ef083fd644a5  rust-script-0.36.0.tar.gz
c2a367b3ad3d715a16dd89bdb52e0c9f8a680b7589b12adc263b738284534c71188c174dd82fba23b6d746a2ce8b7827932073c0bdcdf30cfa5fccf24e333d16  loongarch64-downgrade-libc.patch
"
