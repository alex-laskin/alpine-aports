maintainer="Bart Ribbers <bribbers@disroot.org>"
pkgname=android-build-tools
pkgver=15.0
pkgrel=0
_commit="2ff622d9c4596f247522f6f0a2a1f5afdc38cac1"
pkgdesc="Android build tools"
url="https://developer.android.com/tools/releases/build-tools"
# s390x, ppc64le: Unsupported by vendored BoringSSL
arch="all !s390x !ppc64le !loongarch64"
license="Apache-2.0"
depends="python3"
makedepends="
	bison
	bsd-compat-headers
	cmake
	fmt-dev
	gtest-dev
	expat-dev
	flex
	libpng-dev
	protobuf-dev
	samurai
	"
source="https://dev.alpinelinux.org/archive/android-build-tools/android-build-tools-$_commit.tar.gz
	0001-android-build-tools-Use-patch-rather-than-git.patch
	"
options="!check" # upstream doesn't have a test suite
builddir="$srcdir/$pkgname"

_disturl="dev.alpinelinux.org:/archive/$pkgname/"

snapshot() {
	clean
	deps
	mkdir -p "$srcdir" && cd "$srcdir"
	git clone https://github.com/termux/android-build-tools.git \
		--depth 1 \
		--recurse-submodules \
		--shallow-submodules
	cd android-build-tools && git checkout $_commit && cd -
	tar czvf $SRCDEST/$pkgname-$_commit.tar.gz android-build-tools
	rsync --progress -La $SRCDEST/$pkgname-$_commit.tar.gz $_disturl
}

build() {
	cmake -B build -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DCMAKE_BUILD_TYPE=None
	cmake --build build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
5571e91767198a7c206afd2e6423fcf6a6447d3a80e5600f30196e9cac0b8427b5e4a4c861d23b8d68152a6cbcaefeb1c4a2f4a8fe99008298de9aa1b62b8218  android-build-tools-2ff622d9c4596f247522f6f0a2a1f5afdc38cac1.tar.gz
baba0777c9d0e5ffc1d9972625a98fe957271b3d9b4b5ec6bc357bc1daa8ef5ca360f717cd6fe74c35b586d96260e6faa4d453d63ff3109421a3bde50dad927c  0001-android-build-tools-Use-patch-rather-than-git.patch
"
