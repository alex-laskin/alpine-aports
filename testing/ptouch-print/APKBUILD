# Contributor: Guy Godfroy <guy.godfroy@gugod.fr>
# Maintainer: Guy Godfroy <guy.godfroy@gugod.fr>
pkgname=ptouch-print
pkgver=1.7
pkgrel=0
pkgdesc="Print labels on Brother P-touch printers on Linux"
url="https://git.familie-radermacher.ch/linux/ptouch-print.git"
arch="all"
license="GPL-3.0-or-later"
makedepends="cmake ninja gd-dev gettext-dev libusb-dev argp-standalone"
subpackages="$pkgname-doc"
source="
	https://gitlab.alpinelinux.org/mirror/ptouch-print/-/archive/v1.7/ptouch-print-v1.7.tar.gz
	01-argp.patch
	"
builddir="$srcdir/$pkgname-v$pkgver/"
options="!check" #no test suite

build() {
	if [ "$CBUILD" != "$CHOST" ]; then
		local crossopts="-DCMAKE_SYSTEM_NAME=Linux -DCMAKE_HOST_SYSTEM_NAME=Linux"
	fi
	export CMAKE_EXE_LINKER_FLAGS=-largp
	cmake -B build \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DBUILD_SHARED_LIBS=ON \
		-DCMAKE_BUILD_TYPE=None \
		$crossopts
	cmake --build build
}

check() {
	ctest --test-dir build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}
sha512sums="
310c3eea5312d5d086a58936523b69e18f1980cd1956bf860079e122d49181166bdc6bd0464128a6b3883ff24b4d7b20a057359bf36d58e3c2b895c16e0675e1  ptouch-print-v1.7.tar.gz
8d469b9de3e54fd469281eab5f29235061c93e728270c6cdfae02772189efda170b40811447279146cc2df63de1c0b248ca027b3a90e1f228f0c95bdc6673ac6  01-argp.patch
"
