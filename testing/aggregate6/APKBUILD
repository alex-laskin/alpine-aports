# Maintainer: qaqland <qaq@qaq.land>
pkgname=aggregate6
pkgver=1.0.14
pkgrel=0
pkgdesc="IPv4 and IPv6 prefix aggregation tool"
url="https://github.com/job/aggregate6"
arch="noarch"
license="BSD-2-Clause"
depends="py3-py-radix"
makedepends="py3-gpep517 py3-setuptools py3-wheel"
checkdepends="py3-pytest"
subpackages="$pkgname-doc $pkgname-pyc"
source="https://github.com/job/aggregate6/archive/$pkgver/aggregate6-$pkgver.tar.gz"

provides="py3-$pkgname=$pkgver-r$pkgrel"

build() {
	gpep517 build-wheel \
		--wheel-dir .dist \
		--output-fd 3 3>&1 >&2
}

check() {
	python3 -m venv --clear --without-pip --system-site-packages .testenv
	.testenv/bin/python3 -m installer .dist/*.whl
	.testenv/bin/python3 -m pytest
}

package() {
	python3 -m installer -d "$pkgdir" \
		.dist/*.whl

	install -Dm644 "$pkgdir"/usr/man/man7/aggregate6.7 \
		-t "$pkgdir"/usr/share/man/man7
	rm -r "$pkgdir"/usr/man
}

sha512sums="
09c63b19068b63411b96b4c3f8982d4fc12f91dcab751bb52ab61606396f268183fb73fd2b5488e88b7fa1a07301bda6b73a44871c9967da2ddd3319f3fcaaac  aggregate6-1.0.14.tar.gz
"
