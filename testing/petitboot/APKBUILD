# Contributor: Julian Winkler <julian.winkler1@web.de>
# Maintainer: Jens Reidel <adrian@postmarketos.org>
pkgname=petitboot
pkgver=1.14
pkgrel=0
pkgdesc="Operating system bootloader based on Linux kexec"
url="https://github.com/open-power/petitboot"
arch="all"
license="GPL-2.0-only"
makedepends="
	bison
	elfutils-dev
	eudev-dev
	flex
	lvm2-dev
	musl-libintl
	ncurses-dev
	"
source="
	https://github.com/open-power/petitboot/releases/download/v$pkgver/petitboot-v$pkgver.tar.gz
	musl-gcc15.patch
	ui-Fix-compile-with-curses-opaque-menu-headers.patch
	"
subpackages="
	$pkgname-doc
	$pkgname-dbg
	"

builddir="$srcdir/$pkgname-v$pkgver"

build() {
	HOST_PROG_KEXEC=/usr/sbin/kexec ./configure --prefix=/usr
	make
}

package() {
	make DESTDIR="$pkgdir" install
}

sha512sums="
f4f1264ce0eaf4590efe0a59cba364f2b9b77608b2832d6ae0ec4839bc683947751fd07337f1eaea98c873308f3634e3487d35998d29aa97ad958c1bcd28c638  petitboot-v1.14.tar.gz
e1f2d438b5970a61e8231e99e29edcb660e5f47c425c4480e7b4f6d8cbbddf5e8e9ae9f08c325c72467a3490a2a3f66f24af28df3309feeb0cb072c49ba0b71f  musl-gcc15.patch
1246d469c022009887aefd31312ae97986431444af6518629201dec34ade0c50c7013d0f0d5b8c89a0e8b2f50a9cd5ff73ed4142f8774bb8aa8707d8a720a22a  ui-Fix-compile-with-curses-opaque-menu-headers.patch
"
