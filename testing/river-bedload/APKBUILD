maintainer="Maarten van Gompel <proycon@anaproy.nl>"
pkgname=river-bedload
pkgver=0.1.1_git20250823
_commit=cb75b1cc7e9236aeb0922c58ed5b2cf1c2ec6c33
pkgrel=0
pkgdesc="Print river compositor info in STDOUT"
url="https://git.sr.ht/~novakane/river-bedload"
arch="x86_64 aarch64" # limited by zig aport
license="GPL-3.0-only"
makedepends="
	wayland-dev
	wayland-protocols
	zig
	"
options="!check net"
subpackages="
	$pkgname-doc
	$pkgname-zsh-completion
"
source="
	$pkgname-$_commit.tar.gz::https://git.sr.ht/~novakane/river-bedload/archive/$_commit.tar.gz
	"
builddir="$srcdir/$pkgname-$_commit"

# We may want other than "baseline" for other targets, when enabled by zig
case "$CARCH" in
	aarch64|x86_64) _cputarget=baseline ;;
esac

build() {
	# This installs it to $builddir/out
	DESTDIR="$builddir/out" zig build \
		-Doptimize=ReleaseSafe \
		--prefix /usr install \
		${_cputarget:+-Dcpu="$_cputarget"}
}

package() {
	mkdir -p "$pkgdir"
	cp -r out/* "$pkgdir"
	install -Dm644 "doc/$pkgname.1" -t "$pkgdir/usr/share/man/man1"
	install -Dm644 "completion/zsh/_river_bedload" -t "$pkgdir"/usr/share/zsh/site-functions/
}


sha512sums="
ee67d0053387597bb3f05e87afa94ebb2f98399623606e37643191b49428b10b908733e575f4c7e778c907551916495e48b02f4d9cf80368a2308b98e16ca2c1  river-bedload-cb75b1cc7e9236aeb0922c58ed5b2cf1c2ec6c33.tar.gz
"
