# Contributor: Matthias Ahouansou <matthias@ahouansou.cz>
maintainer="Matthias Ahouansou <matthias@ahouansou.cz>"
pkgname=scooter
pkgver=0.8.2
pkgrel=0
pkgdesc="Interactive find-and-replace in the terminal"
url="https://github.com/thomasschafer/scooter"
arch="all !riscv64" # tests fail due to having the characters in the input box don't match those expected
license="MIT"
makedepends="cargo-auditable oniguruma-dev"
subpackages="$pkgname-doc"
source="$pkgname-$pkgver.tar.gz::$url/archive/refs/tags/v$pkgver.tar.gz"

export RUSTONIG_DYNAMIC_LIBONIG=1

prepare() {
	default_prepare

	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --frozen --release
}

check() {
	# tests that have a very short timeout, but they are difficult to modify, due to not using a constant
	cargo test --frozen -- \
		--skip test_preview_updates_work_correctly::with_advanced_regex \
		--skip test_preview_updates_work_correctly::without_advanced_regex \
		--skip test_search_and_replace_regex_capture_group::with_advanced_regex \
		--skip test_search_and_replace_regex_capture_group::without_advanced_regex \
		--skip test_search_and_replace_advanced_regex_negative_lookahead
}

package() {
	install -Dm755 "target/release/$pkgname" -t "$pkgdir/usr/bin"
	install -Dm644 "LICENSE" "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
}

sha512sums="
71f64b88191761b32ae74509467041ddf0000afe2a0ae68c1b6f81a402dc3d904b5f57069e704069137c555b5a585028c784bc21566debfa9d2b0d406028bd98  scooter-0.8.2.tar.gz
"
