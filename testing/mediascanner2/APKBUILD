maintainer="Aster Boese <asterboese@mailbox.org>"
pkgname=mediascanner2
pkgver=0.118
pkgrel=3
pkgdesc="Media scanner for Lomiri"
url="https://gitlab.com/ubports/development/core/mediascanner2.git"
arch="all"
license="GPL-3.0-only AND LGPL-3.0-only"
source="https://gitlab.com/ubports/development/core/mediascanner2/-/archive/$pkgver/mediascanner2-$pkgver.tar.gz
	0001-rename-msg-to-message.patch
	0002-point-qmlplugindump-to-qmlplugindump-qt5.patch
	0003-disable-coverage-report.patch
	"
makedepends="
	cmake
	dbus-cpp-dev
	gdk-pixbuf-dev
	glib-dev
	gmock
	gtest-dev
	gstreamer-dev
	gst-plugins-base-dev
	libapparmor-dev
	libexif-dev
	qt5-qtbase-dev
	qt5-qtdeclarative-dev
	samurai
	sqlite-dev
	taglib-dev
	udisks2-dev
	"
options="!check" # tests fail to find gmock

build() {
	cmake -B build -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DBUILD_SHARED_LIBS=ON \
		-DCMAKE_BUILD_TYPE=None \
		-DENABLE_TESTS=OFF
	cmake --build build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
ef106972b79f6c75c9ca0b13820b2ced8109ee042737e696d479f19fe2191038c453aa0b2bb0c00e7dce73d86f9bafd6fd1e64c2908453d617ef2faea5d894e0  mediascanner2-0.118.tar.gz
6f043b09d20747c22bd5626d6ba22f3041e2f8c424b774560f3c458cbd93f5cf3fd97a4c7b9e185ad6ed88167b018cab3e5125cf611ea6fe204ca1d1ca2e5545  0001-rename-msg-to-message.patch
7f8d5d804452c1a43408d4b7f404ee8b7b319adcd2a47d22fbd3d6a7e90fe1fa0f9245e4fb245f0495916ee9a5bfd2758cfce389fbfc6b166fdc4bf299db91ba  0002-point-qmlplugindump-to-qmlplugindump-qt5.patch
f6506e78b5ce9de94de5311c6474c585be9b2e928b9dd03bd8ef31d6a8b68e0b9c4ab430eaebccf011d015f0995756ab4b29369f757d00ec5d5096d38ea71219  0003-disable-coverage-report.patch
"
