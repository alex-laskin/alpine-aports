# Maintainer: Celeste <cielesti@protonmail.com>
maintainer="Celeste <cielesti@protonmail.com>"
pkgname=raku-system-query
pkgver=0.1.6
_gitrev=b94ce78b7a155718bca0c6bd8a89e407b43d5315
pkgrel=1
pkgdesc="JSON build decisions based on environmental information"
url="https://github.com/tony-o/p6-warthog"
arch="all"
license="Artistic-2.0"
depends="rakudo"
makedepends="moarvm-dev rakudo-dev"
checkdepends="perl-utils raku-json-fast"
subpackages="$pkgname-doc"
source="$pkgname-$_gitrev.tar.gz::https://github.com/tony-o/p6-warthog/archive/$_gitrev.tar.gz"
builddir="$srcdir/p6-warthog-$_gitrev"
options="!archcheck" # Precompiled arch dependent files included (quiet noarch warning)

build() {
	RAKUDO_RERESOLVE_DEPENDENCIES=0 \
	/usr/share/rakudo/tools/install-dist.raku \
		--to=output --for=vendor
}

check() {
	prove -e 'raku -Ilib'
}

package() {
	mkdir -p "$pkgdir"/usr/share/rakudo
	cp -RT output "$pkgdir"/usr/share/rakudo/vendor

	install -Dvm644 META6.json README.md \
		-t "$pkgdir"/usr/share/doc/$pkgname/
}

sha512sums="
fc0707a969b8fad2bed3c25211eff9dc42116225b87ca81e1af622eeac395cfccf7e70a5e7343a2206c6e488a36c7d9ca95c812be6845926e40334b46a741c87  raku-system-query-b94ce78b7a155718bca0c6bd8a89e407b43d5315.tar.gz
"
