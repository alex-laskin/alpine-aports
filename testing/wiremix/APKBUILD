# Contributor: NeYurii <neyuriizkh@proton.me>
# Maintainer: NeYurii <neyuriizkh@proton.me>
pkgname=wiremix
pkgver=0.7.0
pkgrel=0
pkgdesc="Simple TUI audio mixer for PipeWire"
url="https://github.com/tsowell/wiremix"
# x86, armv7, armhf: https://gitlab.freedesktop.org/pipewire/pipewire-rs/-/issues/111
# s390x: https://github.com/nix-rust/nix/issues/2641
arch="all !x86 !armv7 !armhf !s390x"
license="MIT OR Apache-2.0"
makedepends="cargo cargo-auditable clang-dev pipewire-dev"
source="$pkgname-$pkgver.tar.gz::https://github.com/tsowell/wiremix/archive/refs/tags/v$pkgver.tar.gz"
subpackages="$pkgname-doc"
options="net" # fetch dependencies

prepare() {
	default_prepare
	cargo fetch --target="$CTARGET" --locked
}

build() {
	VERGEN_GIT_DESCRIBE="$pkgver-$pkgrel" cargo auditable build --frozen --release
}

check() {
	cargo test --frozen
}

package() {
	install -Dm755 -t "$pkgdir"/usr/bin target/release/wiremix
	install -Dm644 -t "$pkgdir"/usr/share/wiremix wiremix.toml
	install -Dm644 -t "$pkgdir"/usr/share/doc/"$pkgname" README.md
	install -Dm644 -t "$pkgdir"/usr/share/licenses/"$pkgname" LICENSE-MIT LICENSE-APACHE
}

sha512sums="
8cd98f902a535edb05308aad8ddd00f9c92a6f198451d09ad3729b75ef8b1dafe59b564d1f984eb0863baefe1bc08b49ead56ea62b04adfa0be363e6bee50295  wiremix-0.7.0.tar.gz
"
