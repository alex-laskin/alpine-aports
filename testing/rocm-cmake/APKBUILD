maintainer="Hugo Osvaldo Barrera <hugo@whynothugo.nl>"
pkgname=rocm-cmake
pkgver=6.4.3
pkgrel=0
pkgdesc="CMake modules for common build tasks needed for the ROCm software stack"
url="https://github.com/ROCm/rocm-cmake"
arch="noarch"
license="MIT"
depends="cmake rocm-core"
makedepends="ninja"
checkdepends="git rocm-llvm"
source="rocm-cmake-$pkgver.tar.gz::https://github.com/ROCm/rocm-cmake/archive/refs/tags/rocm-$pkgver.tar.gz"
subpackages="$pkgname-doc"
builddir="$srcdir/rocm-cmake-rocm-$pkgver"
options="!check" # check: circular dependency

prepare() {
	default_prepare

	# Remove tests that require git or unavailable Python modules
	rm test/pass/version-norepo.cmake
	rm test/pass/version-parent.cmake
	rm test/pass/doc-sphinxdoxygen.cmake
	rm test/pass/analyze-gh.cmake
	rm test/pass/analyze.cmake
	rm test/fail/rename-compatibility.cmake
}

build() {
	cmake -B build -G Ninja -Wno-dev \
		-DCMAKE_BUILD_TYPE=None \
		-DCMAKE_INSTALL_PREFIX=/usr
	cmake --build build
}

check() {
	cmake --build build --target check
}

package() {
	DESTDIR="$pkgdir" cmake --install build
	install -Dm644 "$builddir/LICENSE" "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
}

sha512sums="
356aa272d20deed8c0da8ed088079dd8530f23362ff22a563e91380bc543a0d68d2058ba6ec8f7355d1ad0d03578afeff474845ab1f78f23ee553cfccb1791bc  rocm-cmake-6.4.3.tar.gz
"
