maintainer="Hoang Nguyen <folliekazetani@protonmail.com>"
pkgname=helm-unittest
pkgver=1.0.3
pkgrel=0
pkgdesc="Helm plugin to run unit test for Helm charts"
url="https://github.com/helm-unittest/helm-unittest"
arch="all"
license="MIT"
makedepends="go"
checkdepends="yq-go"
install="helm-unittest.pre-install"
source="
	$pkgname-$pkgver.tar.gz::https://github.com/helm-unittest/helm-unittest/archive/refs/tags/v$pkgver.tar.gz
	fix-test-case-32bit.patch
	"
options="net" # download Go modules

build() {
	go build -v ./cmd/helm-unittest/
}

check() {
	go test ./...
}

package() {
	install -Dm755 $pkgname "$pkgdir"/usr/libexec/helm/plugins/unittest

	mkdir -p "$pkgdir"/usr/share/helm/plugins/unittest
	cat <<-EOF > "$pkgdir"/usr/share/helm/plugins/unittest/plugin.yaml
	name: "unittest"
	version: "$pkgver"
	usage: "unittest for helm charts"
	description: "Unit test for helm chart in YAML with ease to keep your chart functional and robust."
	platformCommand:
	  - os: "$(go env GOOS)"
	    arch: "$(go env GOARCH)"
	    command: "/usr/libexec/helm/plugins/unittest"
	EOF
}

sha512sums="
c70c7341ab1aca5b2ea332dd1f89cba4b3a09154d669b4cbcb1ea191824344bddf3b46d0f5e8052975a9bc9a66eb8e758e741d3616f4d9964391961da0e983f0  helm-unittest-1.0.3.tar.gz
500105396c20e3040e12dd0494dbf92e1d0fb01b0a51e3e0f47110ee5241ca9aabc5f5f056d44bf8e7a81a6de2f9c4771e6486e441fb14a0a265015367dd7c83  fix-test-case-32bit.patch
"
