# Contributor: Díaz Urbaneja Diego <sodomon2@gmail.com>
# Maintainer: Díaz Urbaneja Diego <sodomon2@gmail.com>
pkgname=squeak-vm
pkgver=4.10.2.2614
pkgrel=2
pkgdesc="Full-featured implementation of the Smalltalk programming language and environment"
url="http://squeakvm.org"
# x86: textrels
arch="all !x86"
license="MIT"
depends="so:libGL.so.1 libxrender"
makedepends="
	alsa-lib-dev
	cmake
	freetype-dev
	libx11-dev
	mesa-gl
	ninja
	pango-dev
	pulseaudio-dev
	"
options="!check" # not tests
subpackages="$pkgname-doc"
source="http://squeakvm.org/unix/release/Squeak-$pkgver-src.tar.gz
	modernize.patch"
builddir="$srcdir/Squeak-$pkgver-src/"

prepare() {
	default_prepare
	update_config_sub
	update_config_guess
}

build() {
	./unix/cmake/configure \
		--prefix=/usr \
		--without-quartz \
		--with-x \
		--enable-mpg-mmx
	ninja
}

package() {
	DESTDIR="$pkgdir" cmake --install .
}

sha512sums="
b823fb97f7826dbbae5feeb15ffc3ab7e11cf27c5a3cc3f2cf2f8c39b56af5f9d0078d020a4b8f72b997198d296be6d85ec10e0bca10d5214bf586e1e0587f07  Squeak-4.10.2.2614-src.tar.gz
bee505977119e44be67979dd1a4de6a52140f3ad7d123cf83351028d4f9c3d52eb2699735cdeb396d1fe9e1799bae5e87a84ef9cb2caee8eea472b60e8213aa4  modernize.patch
"
