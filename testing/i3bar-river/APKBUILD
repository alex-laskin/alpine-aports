maintainer="Patrycja Rosa <alpine@ptrcnull.me>"
pkgname=i3bar-river
pkgver=1.1.0
pkgrel=1
pkgdesc="Port of i3bar for wlroots-based compositors"
url="https://github.com/MaxVerevkin/i3bar-river"
arch="all"
license="GPL-3.0-only"
makedepends="
	cairo-dev
	cargo
	cargo-auditable
	glib-dev
	pango-dev
	"
subpackages="$pkgname-openrc $pkgname-systemd"
source="https://github.com/MaxVerevkin/i3bar-river/archive/v$pkgver/i3bar-river-$pkgver.tar.gz
	i3bar-river.initd
	i3bar-river.service
	"
options="net" # cargo crates

prepare() {
	default_prepare

	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --frozen --release
}

check() {
	cargo test --frozen
}

package() {
	install -Dm755 target/release/i3bar-river -t "$pkgdir"/usr/bin/
	install -Dm755 "$srcdir"/i3bar-river.initd "$pkgdir"/etc/user/init.d/i3bar-river
	install -Dm644 "$srcdir"/i3bar-river.service -t "$pkgdir"/usr/lib/systemd/user/
}

sha512sums="
eb27c3618e2c7fff4a9bbc74ae85fabac18b3ab72dc649389aa1ce01b264975fb10680cf873e31d103e497b2702cdab83fc8f33c1d0e913bbc594f36cc9bae07  i3bar-river-1.1.0.tar.gz
10b506b8ce7b372027f79983b3489c6dcb6f68721c7bd3004c9ec583111bb28ec4d5f0916f956329c25abffaf967b529a6108bd31fd7bd447e8d8c0028047e25  i3bar-river.initd
7878c5ef719c43fb058f7406e06401195fb57b8944cc35e202623bdb9bdaf3b03e9bde411f721ba72caff8d814402c9cdfa5db5cf1259b2b1794fb85b8be31fe  i3bar-river.service
"
