# Maintainer: Samuel Kalbfleisch <contact+alpine@mallory.re>
pkgname=evolution-etesync
pkgver=1.1.1
pkgrel=0
pkgdesc="EteSync plugin for Evolution"
url="https://gitlab.gnome.org/GNOME/evolution-etesync"
# s390x and riscv64 blocked by libetebase/rust/cargo
arch="all !s390x !riscv64"
license="LGPL-2.1-or-later"
makedepends="cmake ninja evolution evolution-dev evolution-data-server-dev libetebase libetebase-dev intltool"
source="
$pkgname-$pkgver.tar.gz::https://gitlab.gnome.org/GNOME/evolution-etesync/-/archive/$pkgver/evolution-etesync-$pkgver.tar.gz
master_time_t-fix.patch
master_cmake-version.patch
"
subpackages="$pkgname-lang"
options="!check" # no tests

build() {
	cmake -B build \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DBUILD_SHARED_LIBS=True \
		-DCMAKE_BUILD_TYPE=None .
	cmake --build build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
a3831a1bafb0c3f392b0b727dcdb4bedef70771b01c5c92982280314eebd342fbc7d5b7bf0c3f730c4b4e349dc54479474869830538a754276d7e4697bdde91a  evolution-etesync-1.1.1.tar.gz
63a89d9c0dbe6d4ffe50559d53c0e0445f678fddf3b196a3359752e922d331057414996ca6b1b5ea849ddbcf7090e5b86efd5acdca1cf862b597160de38713a9  master_time_t-fix.patch
8a389d998cb4212b6da836d2bedeba7460ee5b9646f65d1c0f45d896e562a71aa4dd82401502c8d5bd08f1d7e3b7a81a6153a198015c0df9b525b52df1e1525e  master_cmake-version.patch
"
