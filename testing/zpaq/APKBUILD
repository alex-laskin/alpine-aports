# Contributor: yabobay <yabobay@yahoo.com>
# Maintainer: yabobay <yabobay@yahoo.com>
maintainer="yabobay <yabobay@yahoo.com>"
pkgname=zpaq
pkgver=7.15
pkgrel=0
pkgdesc="A journaling archiver optimized for backup"
url="https://mattmahoney.net/dc/zpaq.html"
arch="all"
license="Unlicense AND MIT"
makedepends="perl"
subpackages="$pkgname-doc"
source="https://mattmahoney.net/dc/zpaq${pkgver/./}.zip
	10-fix-segfault.patch
	20-remove-march-native.patch"
builddir="$srcdir"

build() {
	case $CARCH in
	x86_64|x86) make ;;
	*) make CPPFLAGS="$CPPFLAGS -DNOJIT" ;;
	esac
}

check() {
	make check
}

package() {
	DESTDIR="$pkgdir" make PREFIX=/usr install
	install -Dm644 COPYING -t "$pkgdir"/usr/share/licenses/zpaq
}

sha512sums="
4cddcc04dff5e9dceb7138cf9e82b718b696048368ff494339f877d93e4423ed7959c0cfb2e30ba7dcbcdd6bbd59fa1021ceaca6d51e3180d8034b7a3997c265  zpaq715.zip
d148fdf54c5be6a63e04532a2e3759efce34010e1faa7fe25244d48e1f60e8f08efa216b00eec72954d295314fd89638bf7f3b9d053ef800eceb745064066840  10-fix-segfault.patch
e40b765918308d6be426dffaa4302ebdbc92add7b747774026d7cfb89bdbbeba6ad0e87d83b5f95874eade7deed883a67f56faf683f80ba5014fdbbaa5c6d533  20-remove-march-native.patch
"
