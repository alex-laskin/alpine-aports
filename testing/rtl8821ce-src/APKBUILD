# Contributor: Kevin Daudt <kdaudt@alpinelinux.org>
# Maintainer: Saijin-Naib <Saijin-Naib_package-maintenance@outlook.com>
pkgname=rtl8821ce-src
_commit=5df613d114d1ca6072aeaf9f64666029896eed61
_modname=${pkgname%-src}
pkgver=6.16_git20250820
pkgrel=0
pkgdesc="Wifi drivers for Realtek 8821ce (src, AKMS)"
url="https://github.com/tomaspinho/rtl8821ce"
arch="x86_64 x86" # Module supports these arches
license="GPL-2.0-only"
options="!check" # No test suite
depends="akms"
source="$pkgname-$_commit.tar.gz::https://github.com/tomaspinho/rtl8821ce/archive/$_commit.tar.gz"
builddir="$srcdir/$_modname-$_commit"

prepare() {
	default_prepare

	cat >AKMBUILD <<-EOF
	modname=$_modname
	modver=$pkgver
	built_modules=8821ce.ko

	# This module doesn't support building outside of its source dir.
	build() {
	    cp -r "\$srcdir"/* .
	    make \$MAKEFLAGS KVER="\$kernel_ver" KSRC="\$kernel_srcdir"
	}
	EOF
}

package() {
	local destdir="$pkgdir/usr/src/$_modname-$pkgver"
	install -Dm0644 -t "$destdir" AKMBUILD Makefile halmac.mk rtl8821c.mk
	cp -r core hal include os_dep platform "$destdir"
}

sha512sums="
1349b13d571db29eb4cebc2dc022ee2d60aeef92ca5afe44093761f59722d0a38ad35c21f509a8f96ea94cd0f18329c3bbb85a8aa09775cfa411c3d6f516c6da  rtl8821ce-src-5df613d114d1ca6072aeaf9f64666029896eed61.tar.gz
"
