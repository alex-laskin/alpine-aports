# Contributor: Fabian Affolter <fabian@affolter-engineering.ch>
# Maintainer: Patrycja Rosa <alpine@ptrcnull.me>
pkgname=py3-libacl
_pkgname=pylibacl
pkgver=0.7.3
pkgrel=0
pkgdesc="A python module for manipulating ACLs"
url="https://pylibacl.k1024.org/"
arch="all"
license="LGPL-2.0-or-later"
makedepends="py3-setuptools python3-dev acl-dev py3-gpep517"
checkdepends="py3-pytest"
source="https://files.pythonhosted.org/packages/source/${_pkgname:0:1}/$_pkgname/$_pkgname-$pkgver.tar.gz
	ub.patch
	rootbld.patch
	"
builddir="$srcdir"/$_pkgname-$pkgver

replaces="py-libacl" # Backwards compatibility
provides="py-libacl=$pkgver-r$pkgrel" # Backwards compatibility

build() {
	gpep517 build-wheel \
		--wheel-dir .dist \
		--output-fd 3 3>&1 >&2
}

check() {
	python3 -m venv --clear --without-pip --system-site-packages .testenv
	gpep517 install-wheel --destdir .testenv --prefix '' .dist/*.whl
	.testenv/bin/python3 -m pytest
}

package() {
	gpep517 install-wheel --destdir "$pkgdir" \
		.dist/*.whl
}

sha512sums="
7a0dae30bf83acd9a1cb1d4008a6322e537d3e3f2004a6393c499574fa9bed8762c01182df67811e8ae04dfb73b40e4bab14c3f191034519b5d3d9822e9d0880  pylibacl-0.7.3.tar.gz
1cde0c5f54955216474dd284ba670eefe8899e30462b3c74dc8bf66b1136e5135b0531a29774ec246839bd3f3657a7eab91e56f319d723afda55d2d7951e41ad  ub.patch
7833d7fed97ab30abf312c63ead208dd466942ea2d5cb52fb050f272c4f844e5fb82e47f6aefe837a9da59c2076c5052af3ee2b4067fc47461330d60984caf1e  rootbld.patch
"
