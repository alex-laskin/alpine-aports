# Maintainer: qaqland <qaq@qaq.land>
pkgname=bat-extras
pkgver=2024.08.24
pkgrel=0
pkgdesc="Bash scripts that integrate bat with various command line tools"
url="https://github.com/eth-p/bat-extras"
arch="noarch"
license="MIT"
depends="
	bash
	bat
	procps-ng
	"
makedepends="shfmt"
checkdepends="
	fish
	ripgrep
	"
subpackages="
	$pkgname-batgrep
	$pkgname-batman
	$pkgname-batpipe
	$pkgname-batwatch
	$pkgname-batdiff
	$pkgname-prettybat
	$pkgname-doc
	"
_best_commit="6b97e0a531f77d2e1f10f48ebb68d4033d69e04d"
_best_tests_commit="e08723efdf636bcd52b6d908d561f175ded2d4b2"
source="https://github.com/eth-p/bat-extras/archive/v$pkgver/bat-extras-$pkgver.tar.gz
	https://github.com/eth-p/best/archive/$_best_commit.tar.gz
	https://github.com/eth-p/best-tests/archive/$_best_tests_commit.tar.gz
	"

prepare() {
	default_prepare

	cp -rT "$srcdir"/best-"$_best_commit" "$builddir"/.test-framework
	cp -rT "$srcdir"/best-tests-"$_best_tests_commit" "$builddir"/.test-framework/tests
}

check() {
	# snapshot:generate: bat-theme changes
	./test.sh --jobs 1 --strict --snapshot:generate --verbose
}

package() {
	./build.sh --prefix="$pkgdir"/usr --install

	install -Dm644 README.md doc/* -t "$pkgdir"/usr/share/doc/$pkgname
	install -Dm644 LICENSE.md -t "$pkgdir"/usr/share/licenses/$pkgname
}

batgrep() {
	pkgdesc="$pkgdesc (batgrep)"
	depends="$pkgname ripgrep"
	amove usr/bin/batgrep
}

batman() {
	pkgdesc="$pkgdesc (batman)"
	depends="$pkgname fzf"
	amove usr/bin/batman
}

batpipe() {
	pkgdesc="$pkgdesc (batpipe)"
	depends="$pkgname"
	amove usr/bin/batpipe
}

batwatch() {
	pkgdesc="$pkgdesc (batwatch)"
	depends="$pkgname exa"
	amove usr/bin/batwatch
}

batdiff() {
	pkgdesc="$pkgdesc (batdiff)"
	depends="$pkgname"
	amove usr/bin/batdiff
}

prettybat() {
	pkgdesc="$pkgdesc (prettybat)"
	depends="
		$pkgname
		cmd:black
		cmd:clang-format
		cmd:prettier
		cmd:rustfmt
		cmd:shfmt
		cmd:yq
		"
	amove usr/bin/prettybat
}

sha512sums="
476297600af9d00f15e75c91ce88f829af298677e03cc9c07ccc387047d68903076e1d0a357523bfeaedfaed5bcd64abbb1c19591bb11f3e34bae1476d3de0ec  bat-extras-2024.08.24.tar.gz
e8029eed1f6d108e831a94c86c3996a4b300736964b6b7d0f2037d72f60a4f9826d6578f9955d4cdffdcd4e8f0c67bc5e8ae2fb037935f5402a714282536a5b3  6b97e0a531f77d2e1f10f48ebb68d4033d69e04d.tar.gz
910b3efb03515ded34790f6fc4575312a4a107eb082a2d2d2319af37abf5a379f3cd5080593ebbb7e56a42607a88fb97679f67572811f079e90a98a6a7cde480  e08723efdf636bcd52b6d908d561f175ded2d4b2.tar.gz
"
