# Contributor: Zach DeCook <zachdecook@librem.one>
maintainer="Krystian Chachu≈Ça <krystian@krystianch.com>"
pkgname=rpicam-apps
pkgver=1.10.0
pkgrel=0
pkgdesc="Suite of libcamera-based applications to drive the Raspberry Pi cameras"
url="https://github.com/raspberrypi/rpicam-apps"
arch="aarch64 armhf armv7" # libcamera by default only includes rpi/vc4 pipeline on these archs
license="BSD-2-Clause"
depends="libcamera-raspberrypi"
makedepends="
	boost-dev
	ffmpeg-dev
	libcamera-dev
	libdrm-dev
	libexif-dev
	libjpeg-turbo-dev
	libpng-dev
	meson
	musl-dev
	tiff-dev
"
subpackages="$pkgname-doc"
source="
	https://github.com/raspberrypi/rpicam-apps/archive/v$pkgver/rpicam-apps-v$pkgver.tar.gz
	"

build() {
	abuild-meson \
		-Denable_libav=enabled \
		-Denable_drm=enabled \
		-Denable_egl=disabled \
		-Denable_qt=disabled \
		-Denable_opencv=disabled \
		-Denable_tflite=disabled \
		-Dneon_flags=auto \
		-Denable_hailo=disabled \
		-Ddownload_hailo_models=false \
		build .
	meson compile -C build
}

check() {
	meson test --print-errorlogs -C build
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C build
	install -Dm644 license.txt "$pkgdir"/usr/share/licenses/$pkgname/license.txt
}

sha512sums="
3cbedfd35ead3a8df5d6abcfe9ad9eab65cb4af53538e558482478ffec37f3754bb8c8f62d6144335430c1e502f101193d26e7c4868856f651947b9e44a48a55  rpicam-apps-v1.10.0.tar.gz
"
