# Contributor: Matthias Ahouansou <matthias@ahouansou.cz>
maintainer="Matthias Ahouansou <matthias@ahouansou.cz>"
pkgname=wild
pkgver=0.6.0_git20251009
_gitrev=fdbf44a58cbc5197d0996d181dde3714682e8bf8
pkgrel=0
pkgdesc="Very fast linker for Linux"
url="https://github.com/davidlattimore/wild"
# Only x86_64, aarch64 and riscv64 are officially supported (as of 0.6.0)
# https://github.com/davidlattimore/wild?tab=readme-ov-file#whats-working
arch="x86_64 aarch64 riscv64"
license="MIT OR Apache-2.0"
makedepends="cargo-auditable"
checkdepends="
	bash
	cmd:clang-format
	lld
"
# gcc doesn't support using arbitrary linkers
depends="clang"
subpackages="$pkgname-doc"
source="
	$pkgname-$_gitrev.tar.gz::https://github.com/davidlattimore/wild/archive/$_gitrev.tar.gz
"
options="net"
builddir="$srcdir/$pkgname-$_gitrev"

prepare() {
	default_prepare

	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --release --frozen
}

check() {
	cargo test --frozen
}

package() {
	install -Dm 755 target/release/wild "$pkgdir"/usr/bin/wild

	install -Dm 644 LICENSE-APACHE LICENSE-MIT -t "$pkgdir"/usr/share/licenses/"$pkgname"/
}

sha512sums="
bfcbfe7a08b21c60a8df36a6c05e20e21a4d0bb88046a12c62e884e82125c22a74be31403b6eb5713446c001de1b0838b7ed13562fee101bd66aa1b9d220773b  wild-fdbf44a58cbc5197d0996d181dde3714682e8bf8.tar.gz
"
