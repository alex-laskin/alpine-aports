# Contributor: Ron Nazarov <ron@noisytoot.org>
# Maintainer: Ron Nazarov <ron@noisytoot.org>
pkgname=xmoto
pkgver=0.6.3
pkgrel=0
pkgdesc="A challenging 2D motocross platform game, where physics play an important role"
url="https://xmoto.org/"
arch="all"
license="GPL-2.0-or-later"
depends="$pkgname-data"
makedepends="
	bzip2-dev
	cmake
	curl-dev
	glu-dev
	jpeg-dev
	libxdg-basedir-dev
	libxml2-dev
	samurai
	sdl2-dev
	sdl2_mixer-dev
	sdl2_net-dev
	sdl2_ttf-dev
	sqlite-dev
	xz-dev
	zlib-dev
	"
subpackages="$pkgname-doc $pkgname-lang $pkgname-data::noarch"
options="!check" # no test suite
source="$pkgname-$pkgver.tar.gz::https://github.com/xmoto/xmoto/archive/refs/tags/v$pkgver.tar.gz
	add-missing-cstdint-includes.patch"

build() {
	if [ "$CBUILD" != "$CHOST" ]; then
		local cmake_crossopts="-DCMAKE_SYSTEM_NAME=Linux -DCMAKE_HOST_SYSTEM_NAME=Linux"
	fi
	cmake -B build -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_BUILD_TYPE=Release \
		$cmake_crossopts
	cmake --build build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

data() {
	pkgdesc="$pkgdesc (data files)"

	amove usr/share/xmoto
}

sha512sums="
7c261058059cd4495fc79cd48fbf729f02bbc5678cbbb340baf2691d52cb8a5a30af89b788facb51991323f9630cff7416388d218f1713033dc4ea58e0727c3e  xmoto-0.6.3.tar.gz
bd4d030f60811a2846b81c2af69adc65df8055fab67608fa177b8cfeff592bd8ee549812959cf6ea6cf6c9274980ded9fab4a8bf25086ec72f3c9e17cd14b00b  add-missing-cstdint-includes.patch
"
