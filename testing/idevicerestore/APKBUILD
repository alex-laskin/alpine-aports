# Contributor: Kasper K <kasperkantz@outlook.com>
maintainer="Krassy Boykinov <kboykinov@teamcentrixx.com>"
pkgname=idevicerestore
pkgver=1.0.0_git20250914
pkgrel=0
_commit=a0cec3b34fb112168aaae9fbb024e15302563b34
pkgdesc="Restore/upgrade firmware of iOS devices"
url="https://libimobiledevice.org"
arch="all"
license="LGPL-2.1-or-later"
makedepends="
	autoconf
	automake
	curl-dev
	libimobiledevice-dev
	libirecovery-dev
	libtatsu-dev
	libtool
	libzip-dev
	m4
"
depends="usbmuxd"
subpackages="$pkgname-doc"
source="
	$pkgname-$pkgver.tar.gz::https://codeload.github.com/libimobiledevice/idevicerestore/tar.gz/$_commit
	90-apple-dfu.rules
"
builddir="$srcdir/$pkgname-$_commit"

prepare() {
	default_prepare
	export RELEASE_VERSION="$pkgver"
	NOCONFIGURE=1 ./autogen.sh
}

build() {
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--disable-static
	make
}

check() {
	make check
}

package() {
	make DESTDIR="$pkgdir" install

	install -Dm644 "$srcdir"/90-apple-dfu.rules \
		-t "$pkgdir"/usr/lib/udev/rules.d
}

sha512sums="
e87660c7888d8c986b7230c44db75b34fd7917f45554645e52bcabda2b374859efc3ca3da0f69374fe2c7855534dfd0607693193394cf819a87bb8dc34b0935e  idevicerestore-1.0.0_git20250914.tar.gz
619d29ba5842584d10fdea1e18eac442c6ca8377ba6bcc7eccec8046aef490641cc1c62032365fed6f958788a457cccb20ab4d5bfd4cdc657114de38f1bcf3a7  90-apple-dfu.rules
"
