# Contributor: lauren n. liberda <lauren@selfisekai.rocks>
# Maintainer: lauren n. liberda <lauren@selfisekai.rocks>
pkgname=dart-stage0
# upgrade checklist: https://md.sdomi.pl/Q-ECZTJ2Qqyp3ahfJuYSBw
pkgver=3.9.0_alpha27_p0
pkgrel=0
pkgdesc="Dart is a client-optimized language for fast apps on any platform (temporary bootstrap package)"
url="https://dart.dev/"
arch="aarch64 armv7 riscv64 x86_64"
license="BSD-3-Clause"
options="!check"

_canonver="${pkgver/_p/.}"
case "$pkgver" in
	*.*.*_alpha*)
		_canonver="${_canonver/_alpha/-}.dev"
		;;
	*.*.*_beta*)
		_canonver="${_canonver/_beta/-}.beta"
		;;
esac

source="
	dart-musl-stage0-x64-$_canonver.tar.gz.noauto::https://github.com/dart-musl/dart/releases/download/$_canonver/dartsdk-linux-x64-release.tar.gz
	dart-musl-stage0-arm-$_canonver.tar.gz.noauto::https://github.com/dart-musl/dart/releases/download/$_canonver/dartsdk-linux-arm-release.tar.gz
	dart-musl-stage0-arm64-$_canonver.tar.gz.noauto::https://github.com/dart-musl/dart/releases/download/$_canonver/dartsdk-linux-arm64-release.tar.gz
	dart-musl-stage0-riscv64-$_canonver.tar.gz.noauto::https://github.com/dart-musl/dart/releases/download/$_canonver/dartsdk-linux-riscv64-release.tar.gz
"
builddir="$srcdir/"

provides="dart-bootstrap=$pkgver-r$pkgrel"
provider_priority=42

case "$CARCH" in
	aarch64) _dart_arch="arm64" ;;
	armv7) _dart_arch="arm" ;;
	riscv64) _dart_arch="riscv64" ;;
	x86_64) _dart_arch="x64" ;;
esac

build() {
	:
}

package() {
	mkdir -p "$pkgdir"/usr/lib "$pkgdir"/usr/bin "$pkgdir"/usr/include
	(
		cd "$pkgdir"/usr/lib
		tar xf "$srcdir"/dart-musl-stage0-$_dart_arch-$_canonver.tar.gz.noauto
		mv dart-sdk dart
	)
	ln -s ../lib/dart/bin/dart "$pkgdir"/usr/bin/dart
	ln -s ../lib/dart/bin/dartaotruntime "$pkgdir"/usr/bin/dartaotruntime
	ln -s ../lib/dart/include "$pkgdir"/usr/include/dart
}

sha512sums="
7de4cdbcb25d049c4afe7d6185c94eaf4eb74758330a7b04bf00cc2a45c1bef340208fefe5dfedb5b5e1523694834e27fc088e68c5a58ddbb45866bf6fd88ff0  dart-musl-stage0-x64-3.9.0-27.0.dev.tar.gz.noauto
7f8404350cf1dfbc63f20cb2df7fcb1ebc9c82d047128aea344f222b91ed7af8e51c8173c334746f2ccc9071ee913bd7460b267b3c95bf53dc6411b3728927ad  dart-musl-stage0-arm-3.9.0-27.0.dev.tar.gz.noauto
bd31ae9ed7b2946b4db2a4641a443e2d3b5b96fa071c6e73c612dfccf454fe70a8cc91c7b14d7ed8d67b72e59f784831545caddeefc032f322cd8a891f204100  dart-musl-stage0-arm64-3.9.0-27.0.dev.tar.gz.noauto
8267a3d17c4cd9d2d6aae90541ccaf75ab6fcc70fcf211277145b83ab91c9ad137ab76df13a195bd2b92489322f1d49c011a34f9de97e51739c2caddeb0b0212  dart-musl-stage0-riscv64-3.9.0-27.0.dev.tar.gz.noauto
"
