maintainer="Achill Gilgenast <achill@achill.org>"
pkgname=pwvucontrol
pkgver=0.5.0
pkgrel=0
pkgdesc="Pipewire Volume Control"
url="https://github.com/saivert/pwvucontrol"
# 32-bit: pipewire crate fails
# s390x: nix
arch="all !armhf !armv7 !x86 !s390x"
license="GPL-3.0-or-later"
makedepends="
	cargo
	cargo-auditable
	clang-dev
	desktop-file-utils
	gtk4.0-dev
	libadwaita-dev
	meson
	pipewire-dev
	wireplumber-dev
	"
subpackages="$pkgname-dbg $pkgname-lang"
source="$pkgname-$pkgver.tar.gz::https://github.com/saivert/pwvucontrol/archive/refs/tags/$pkgver.tar.gz
	wireplumber-0.5.patch
	"
options="net" # fetch cargo dependencies

prepare() {
	default_prepare
	cargo fetch --locked
}

build() {
	abuild-meson . output
	meson compile -C output
}

check() {
	meson test --no-rebuild -C output
}

package() {
	meson install --no-rebuild --destdir "$pkgdir" -C output
}

sha512sums="
ce3b5dd7f7aca4e38814722972d12701219f7fd290e11d9ab83f3223760a7aa42d2a5a1abc87f0005a3ec07d66ffc21e77b39dbf8d625d3fd8964ed7c69df9cc  pwvucontrol-0.5.0.tar.gz
1c02a96071f060a8bf5900aecf0cb9afd684a3a7cff2453d5c97fd641f7ab3ad5f997e5068189e65edd9e87b226d4e02424564d04b911c429fe0d734696b2e8a  wireplumber-0.5.patch
"
