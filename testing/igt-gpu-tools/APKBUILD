# Contributor: Dennis Krupenik <dennis@krupenik.com>
# Maintainer: Dennis Krupenik <dennis@krupenik.com>
pkgname=igt-gpu-tools
pkgver=2.2
pkgrel=0
pkgdesc="collection of tools for development and testing of the DRM drivers"
url="https://gitlab.freedesktop.org/drm/igt-gpu-tools/"
arch="x86_64" # intel gpus, aarch64 fails to build
license="MIT"
depends_dev="
	alsa-lib-dev
	cairo-dev
	curl-dev
	elfutils-dev
	eudev-dev
	gsl-dev
	json-c-dev
	kmod-dev
	libdrm-dev
	liboping-dev
	libpciaccess-dev
	libunwind-dev
	libxrandr-dev
	libxv-dev
	pixman-dev
	procps-compat-dev
	xmlrpc-c-dev
	"
makedepends="
	$depends_dev
	bison
	flex
	meson
	"
# Test igt_hook calls grep -z
checkdepends="bash grep"
subpackages="$pkgname-dev"
source="https://xorg.freedesktop.org/archive/individual/app/igt-gpu-tools-$pkgver.tar.xz
	skip-tests.patch
	"

build() {
	abuild-meson \
		-Dvalgrind=disabled \
		-Dversion_hash=$pkgver \
		. build
	meson compile -C build
}

check() {
	meson test --print-errorlogs -C build
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C build
}
sha512sums="
20032b90e397ca73f9f8f5b453034fffc09e28372adddebd1a71b1323235e3e379bf452d5a4dd76b895e4c47df67595051c16b8a1488249e5aae946f6a35258c  igt-gpu-tools-2.2.tar.xz
4bb7465485f98e42a88f7522e45ee1c942113354f78ff3cd81d2eea75098b1baa32fdd67b0c792338ef9ba989103f9ec6b43e05854e1e6862233d3a863c4e40b  skip-tests.patch
"
