# Maintainer: Sertonix <sertonix@posteo.net>
pkgname=chimerautils
pkgver=14.3.1
pkgrel=0
pkgdesc="Chimera's core userland, based on FreeBSD"
arch="all"
url="https://github.com/chimera-linux/chimerautils"
license="BSD-2-Clause"
subpackages="
	$pkgname-dbg
	"
makedepends="
	acl-dev
	bison
	bsd-compat-headers
	bzip2-dev
	flex
	libedit-dev
	libxo-dev
	linux-headers
	muon
	ncurses-dev
	openssl-dev
	xz-dev
	zlib-dev
	zstd-dev
	"
source="chimerautils-$pkgver.tar.gz::https://github.com/chimera-linux/chimerautils/archive/refs/tags/v$pkgver.tar.gz
	muon.patch
	"
# no tests
options="!check"

build() {
	abuild-muon \
		--auto-features=disabled \
		--bindir=/usr/lib/$pkgname/bin \
		--sbindir=/usr/lib/$pkgname/sbin \
		--libexecdir=/usr/lib/$pkgname \
		-Dinstall-lib=false \
		output
#		-Dchimera_realpath=enabled \
	ninja -C output
}

package() {
	DESTDIR="$pkgdir" muon -C output install
	# Conflicts with other packages
	rm -r "$pkgdir"/usr/share/man
}

sha512sums="
db769699e64b490adcc05fb7d945f7b0288a0ee9206d7919495457e71c83ff20c15fbaa50b7b8c4885a74b22adb8a65e8770e7a2449b8058ef3bd40b180719e5  chimerautils-14.3.1.tar.gz
cd31e468977013ef9a5505a6e27812caffb75bd21dbf6d1aa38b32890e07285d8d58889c59f25919e88e4613c7d2338c9198fa012530b30050d910ce3e545d36  muon.patch
"
