# Contributor: Eivind Uggedal <eu@eju.no>
# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=fcgiwrap
pkgver=1.1.0
pkgrel=9
pkgdesc="Simple server for running CGI applications over FastCGI"
url="https://github.com/gnosek/fcgiwrap"
arch="all"
license="MIT"
pkgusers="fcgiwrap"
pkggroups="www-data"
install="$pkgname.pre-install"
makedepends="autoconf libtool automake fcgi-dev"
subpackages="$pkgname-doc $pkgname-openrc"
source="$pkgname-$pkgver.tar.gz::https://github.com/gnosek/fcgiwrap/archive/$pkgver.tar.gz
	no-buffering.patch
	$pkgname.initd
	$pkgname.confd"
options="!check"

build() {
	autoreconf --install
	CFLAGS="$CFLAGS -Wno-implicit-fallthrough" \
	./configure --prefix=/usr \
		--mandir=/share/man \
		--sbindir=/bin
	make
}

package() {
	install -d -m2775 -o fcgiwrap -g www-data  "$pkgdir"/run/fcgiwrap
	make DESTDIR="$pkgdir" install
	install -Dm755 $srcdir/$pkgname.initd "$pkgdir"/etc/init.d/$pkgname
	install -Dm644 $srcdir/$pkgname.confd "$pkgdir"/etc/conf.d/$pkgname
}

sha512sums="
b8d35762d1d3c94a67602290b0092f0c38cffbbcd3dbc16597abf8b92172909b04450c238de2e430e841a17dd47fdd48d6a001f77539966980ef1af61e447ddc  fcgiwrap-1.1.0.tar.gz
72ba8a0d044c86cc41358002b1cbb94e77dc81e56669032b474b94d7cde80e6cc5d041a064d79ed98b7db8aee9ffcc8830df88491f14afa251781487a57fd429  no-buffering.patch
c1cf048fc4ceff60e656576c99ab1cb22bfc3515b1e6422b923a36a0a8485652bad87e15ac8fe78d14280679f1c8d31621c493ed8e5d5a9cb4cbb070740f3269  fcgiwrap.initd
4fed56a56eca0a067646f8571175f473fb9f941b6710ba4618158c1c38443a78abe168f1d41be9d50290e1578a0573d894f10429abffb2edbaa20845ea49f0c3  fcgiwrap.confd
"
