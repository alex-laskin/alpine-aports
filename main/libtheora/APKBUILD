# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=libtheora
pkgver=1.2.0
pkgrel=0
pkgdesc="An open video codec developed by the Xiph.org"
url="https://www.xiph.org"
arch="all"
license="BSD-3-Clause"
subpackages="$pkgname-static $pkgname-dev $pkgname-doc"
depends_dev="libogg-dev"
makedepends="libvorbis-dev libogg-dev autoconf automake libtool
	linux-headers"
source="https://downloads.xiph.org/releases/theora/libtheora-$pkgver.tar.gz
	getopt-gcc15.patch
	0001-Add-missing-arm-files.patch
	"

build() {
	CFLAGS="${CFLAGS/-Os/-O3}" CPPFLAGS="${CPPFLAGS/-Os/-O3}" ./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--enable-shared \
		--enable-static
	make
}

check() {
	make check
}

package() {
	make -j1 DESTDIR="$pkgdir" install
}

static() {
	depends=""
	pkgdesc="$pkgdesc (static libraries)"
	mkdir -p "$subpkgdir"/usr/lib
	mv "$pkgdir"/usr/lib/*.a "$subpkgdir"/usr/lib
}

sha512sums="
2f64006b645df1bf0d4d8dd3f35bdce4d92bf676f1bc4acc050ea5add1c7363c87548206f089a30898bf551cc447ba0c7a15d10b50061fd8a98902697499a288  libtheora-1.2.0.tar.gz
2f1d580ba0ff44f0da440c6b9856aa3de58f453ebfb745095c2a535b112c4c726d7b73a30367a9012158b9af8e13cdb058e49f5edb39b269f924f8163fe95be1  getopt-gcc15.patch
09388015045b6fb7d63ec60749a0e1612bc6e2c9879b002884a88facf64edda59923e2b6756a014762b29811d6d36ad98fc0fc3095922588f430e93d5847340f  0001-Add-missing-arm-files.patch
"
