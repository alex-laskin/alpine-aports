From c08f14178a6a6e43f292b7293bc04a9ea3de43ac Mon Sep 17 00:00:00 2001
From: Achill Gilgenast <achill@achill.org>
Date: Fri, 19 Sep 2025 10:18:43 +0200
Subject: [PATCH 10/10] system-uefi-ld.patch

Signed-off-by: Achill Gilgenast <achill@achill.org>
---
 compiler/rustc_target/src/spec/targets/aarch64_unknown_uefi.rs | 1 +
 compiler/rustc_target/src/spec/targets/x86_64_unknown_uefi.rs  | 1 +
 2 files changed, 2 insertions(+)

diff --git a/compiler/rustc_target/src/spec/targets/aarch64_unknown_uefi.rs b/compiler/rustc_target/src/spec/targets/aarch64_unknown_uefi.rs
index 327b52389b93..54ee42dab503 100644
--- a/compiler/rustc_target/src/spec/targets/aarch64_unknown_uefi.rs
+++ b/compiler/rustc_target/src/spec/targets/aarch64_unknown_uefi.rs
@@ -10,6 +10,7 @@ pub(crate) fn target() -> Target {
     base.add_pre_link_args(LinkerFlavor::Msvc(Lld::No), &["/machine:arm64"]);
     base.features = "+v8a".into();
 
+    base.linker = Some("lld".into());
     Target {
         llvm_target: "aarch64-unknown-windows".into(),
         metadata: TargetMetadata {
diff --git a/compiler/rustc_target/src/spec/targets/x86_64_unknown_uefi.rs b/compiler/rustc_target/src/spec/targets/x86_64_unknown_uefi.rs
index 0cf6a8794621..b7ed54eb8cdd 100644
--- a/compiler/rustc_target/src/spec/targets/x86_64_unknown_uefi.rs
+++ b/compiler/rustc_target/src/spec/targets/x86_64_unknown_uefi.rs
@@ -29,6 +29,7 @@ pub(crate) fn target() -> Target {
     base.features = "-mmx,-sse,+soft-float".into();
     base.rustc_abi = Some(RustcAbi::X86Softfloat);
 
+    base.linker = Some("lld".into());
     Target {
         llvm_target: "x86_64-unknown-windows".into(),
         metadata: TargetMetadata {
-- 
2.51.0

